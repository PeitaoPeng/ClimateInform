#!/bin/sh

set -eaux

lcdir=/export-6/sgi9/wd52pp/project/emd_prd/src
tmpdir=/export-6/sgi9/wd52pp/tmp
datadir=/export-6/cacsrv1/wd52pp/emd

longtime=636
lag=318
ndata=7
maxperiod=636
minperiod=2

cp $lcdir/pw_spectrum.F $tmpdir/.
cd $tmpdir

#
cat > parm.h << eof
       PARAMETER (NDYS=$longtime)
       PARAMETER (LAG=$lag,LLAG=LAG+1,neofs=$ndata)
       PARAMETER (DELTAT=1.)
       PARAMETER (ntopper=$maxperiod,nbotper=$minperiod)
eof
#
cat > parm2.h << eof
       PARAMETER (MAXLAG=$lag+1)
       PARAMETER (xkai2=8.6515)
c      PARAMETER (xkai2=11.83)
eof
#
f77 -o pw_spectrum.x  pw_spectrum.F
echo "done compiling"

/bin/rm $tmpdir/fort.*
#
ln -s $datadir/imf_monthly.ao.index.5001-0212.i3e fort.10
ln -s $datadir/pwspec_imf_monthly.ao.index.5001-0212.txt  fort.70
ln -s $datadir/pwspec_imf_monthly.ao.index.5001-0212.i3e  fort.80

pw_spectrum.x > $lcdir/out

cat>$datadir/pwspec_imf_monthly.ao.index.5001-0212.ctl<<EOF
dset ^pwspec_imf_monthly.ao.index.5001-0212.i3e
*options big_endian
undef -9.99E+33
title EXP1
xdef  1  linear  0 0.1
ydef  1  linear -90.  5
zdef  $lag  levels 636.000  318.000  212.000  159.000  127.200  106.000   90.857   79.500
  70.667   63.600   57.818   53.000   48.923   45.429   42.400   39.750
  37.412   35.333   33.474   31.800   30.286   28.909   27.652   26.500
  25.440   24.462   23.556   22.714   21.931   21.200   20.516   19.875
  19.273   18.706   18.171   17.667   17.189   16.737   16.308   15.900
  15.512   15.143   14.791   14.455   14.133   13.826   13.532   13.250
  12.980   12.720   12.471   12.231   12.000   11.778   11.564   11.357
  11.158   10.966   10.780   10.600   10.426   10.258   10.095    9.938
   9.785    9.636    9.493    9.353    9.217    9.086    8.958    8.833
   8.712    8.595    8.480    8.368    8.260    8.154    8.051    7.950
   7.852    7.756    7.663    7.571    7.482    7.395    7.310    7.227
   7.146    7.067    6.989    6.913    6.839    6.766    6.695    6.625
   6.557    6.490    6.424    6.360    6.297    6.235    6.175    6.115
   6.057    6.000    5.944    5.889    5.835    5.782    5.730    5.679
   5.628    5.579    5.530    5.483    5.436    5.390    5.345    5.300
   5.256    5.213    5.171    5.129    5.088    5.048    5.008    4.969
   4.930    4.892    4.855    4.818    4.782    4.746    4.711    4.676
   4.642    4.609    4.576    4.543    4.511    4.479    4.448    4.417
   4.386    4.356    4.327    4.297    4.268    4.240    4.212    4.184
   4.157    4.130    4.103    4.077    4.051    4.025    4.000    3.975
   3.950    3.926    3.902    3.878    3.855    3.831    3.808    3.786
   3.763    3.741    3.719    3.698    3.676    3.655    3.634    3.614
   3.593    3.573    3.553    3.533    3.514    3.495    3.475    3.457
   3.438    3.419    3.401    3.383    3.365    3.347    3.330    3.313
   3.295    3.278    3.262    3.245    3.228    3.212    3.196    3.180
   3.164    3.149    3.133    3.118    3.102    3.087    3.072    3.058
   3.043    3.029    3.014    3.000    2.986    2.972    2.958    2.944
   2.931    2.917    2.904    2.891    2.878    2.865    2.852    2.839
   2.827    2.814    2.802    2.789    2.777    2.765    2.753    2.741
   2.730    2.718    2.706    2.695    2.684    2.672    2.661    2.650
   2.639    2.628    2.617    2.607    2.596    2.585    2.575    2.565
   2.554    2.544    2.534    2.524    2.514    2.504    2.494    2.484
   2.475    2.465    2.456    2.446    2.437    2.427    2.418    2.409
   2.400    2.391    2.382    2.373    2.364    2.356    2.347    2.338
   2.330    2.321    2.313    2.304    2.296    2.288    2.280    2.271
   2.263    2.255    2.247    2.239    2.232    2.224    2.216    2.208
   2.201    2.193    2.186    2.178    2.171    2.163    2.156    2.149
   2.141    2.134    2.127    2.120    2.113    2.106    2.099    2.092
   2.085    2.078    2.072    2.065    2.058    2.052    2.045    2.038
   2.032    2.025    2.019    2.013    2.006    2.000
tdef 99 linear jan94  1mon
vars  2
ps    $lag 99 pwspec
rt    $lag 99 red noise test
endvars
EOF

