#!/bin/sh

set -eaux

lcdir=/cpc/home/wd52pp/project/prd_test/eocn
tmp=/cpc/home/wd52pp/tmp
datadir=/cpc/home/wd52pp/data/prd_test
#
last_yr=2016
longtime=86
ntprd=56  # ntprd=longtime-30
mode=6
mrot=8
var=temp
kp=30 #for temp
#kp=15 #for prec
ndec=6
#
cp $lcdir/eocn_prd_hss.f $tmp/eocnprd_hss.f
cp $lcdir/reof.s.f $tmp/reof.s.f
cd $tmp
#
for season in jfm fma mam amj mjj jja jas aso son ond ndj djf; do
#for season in jfm; do
#
if [ "$season" = jfm ]; then mons=1; fi
if [ "$season" = fma ]; then mons=2; fi
if [ "$season" = mam ]; then mons=3; fi
if [ "$season" = amj ]; then mons=4; fi
if [ "$season" = mjj ]; then mons=5; fi
if [ "$season" = jja ]; then mons=6; fi
if [ "$season" = jas ]; then mons=7; fi
if [ "$season" = aso ]; then mons=8; fi
if [ "$season" = son ]; then mons=9; fi
if [ "$season" = ond ]; then mons=10; fi
if [ "$season" = ndj ]; then mons=11; fi
if [ "$season" = djf ]; then mons=12; fi
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(mmax=$mode)
       parameter(mrot=$mrot)   !mode # to rotate
       parameter(ntprd=$ntprd)
       parameter(iseason=$mons)
       parameter(kp=$kp)
       parameter(ndec=$ndec)  !# of wmo clim for the whole data length
eof
#
gfortran -o eocnprd_hss.x reof.s.f eocnprd_hss.f
echo "done compiling"
#
/bin/rm $tmp/fort.*         
#
#
 ln -s /cpc/home/wd52pp/data/LF_prd/${var}_102.txt          fort.10
#
 ln -s $datadir/wmoobs_${var}.$season.1991-$last_yr.i3e     fort.20
 ln -s $datadir/eocnprd_${var}.$season.1991-$last_yr.i3e    fort.25
 ln -s $datadir/eocnprd_hss_${var}.$season.1991-$last_yr.gr   fort.40
 ln -s $datadir/eocnprd_${var}.$season.1991-$last_yr.non-norm.gr   fort.50
 ln -s $datadir/eocnprd_rpc.$season.1961-$last_yr.gr   fort.60
#
eocnprd_hss.x > $datadir/eocnprd_hss.$season.out
#

cat>$datadir/eocnprd_hss_${var}.$season.1991-$last_yr.ctl<<EOF
dset $datadir/eocnprd_hss_${var}.$season.1991-$last_yr.gr
undef 999.0
title Realtime Surface Obs
xdef    1 linear    0.000  1
ydef    1 linear    0.000  5
zdef    1 levels 500
tdef $ntprd linear jan1991  1yr
vars   1
hs   0 99 Type of Ob
endvars
EOF
#
cat>$datadir/eocnprd_rpc.$season.1961-$last_yr.ctl<<EOF2
dset $datadir/eocnprd_rpc.$season.1961-$last_yr.gr
undef 999.0
title Realtime Surface Obs
xdef    1 linear    0.000  1
ydef    1 linear    0.000  5
zdef    1 levels 500
tdef $ntprd linear jan1961 1yr
vars   12
p1   0 99 rpc1 of prd
v1   0 99 rpc1 of obs
p2   0 99 rpc2 of t2m
v2   0 99 rpc2 of t2m
p3   0 99 rpc3 of t2m
v3   0 99 rpc3 of t2m
p4   0 99 rpc4 of t2m
v4   0 99 rpc4 of t2m
p5   0 99 rpc5 of t2m
v5   0 99 rpc5 of t2m
p6   0 99 rpc6 of t2m
v6   0 99 rpc6 of t2m
endvars
EOF2
#
done
