#!/bin/sh           

set -eaux

 var=temp
#var=prcp
lcdir=/cpc/home/wd52pp/project/prd_test/eocn
tmpdir=/cpc/home/wd52pp/tmp
datadir=/cpc/home/wd52pp/data/prd_test
eyear=2012
longtime=82
id=0 # ID=0: covariance matrix; ID>0:correlation matrix

cp $lcdir/eof_cd.f  $tmpdir/eof_cd.f
cp $lcdir/reof.s.f  $tmpdir/.
cp $lcdir/CD102_2_2x2.s.f  $tmpdir/.
cd $tmpdir


#for season in jfm fma mam amj mjj jja jas aso son ond ndj djf; do
for season in djf; do
cat > parm.h << eof
       parameter(ltime=$longtime,mode=6)
       parameter(ID=$id)
eof
#
gfortran -o eof_cd.x eof_cd.f CD102_2_2x2.s.f reof.s.f
echo "done compiling"

/bin/rm fort.*
#
 ln -s $datadir/${var}_102_anom_1931-$eyear.$season.txt fort.11

 ln -s $datadir/reof.${var}_102_anom_1931-$eyear.$season.i3e fort.81
 ln -s $datadir/rpc.${var}_102_anom_1931-$eyear.$season.i3e  fort.82
 ln -s $datadir/eof.${var}_102_anom_1931-$eyear.$season.i3e fort.91
 ln -s $datadir/pc.${var}_102_anom_1931-$eyear.$season.i3e  fort.92
 eof_cd.x > $datadir/reof.${var}_102_anom_1931-$eyear.$season.out

cat>$datadir/rpc.${var}_102_anom_1931-$eyear.$season.ctl<<EOF
dset ^rpc.${var}_102_anom_1931-$eyear.$season.i3e
undef -9.99E+33
title EXP1
xdef   1 linear  0.0  1
ydef   1 linear  0.0  1
zdef   1 levels 500
tdef  $longtime linear     jan1931     1yr
vars  6
pc1 0 99 non-rot pc 1
pc2 0 99 non-rot pc 2
pc3 0 99 non-rot pc 3
pc4 0 99 non-rot pc 4
pc5 0 99 non-rot pc 5
pc6 0 99 non-rot pc 6
endvars
EOF
cat>$datadir/reof.${var}_102_anom_1931-$eyear.$season.ctl<<EOF
dset $datadir/reof.${var}_102_anom_1931-$eyear.$season.i3e
undef -9999.0
xdef   36 linear -130 2
ydef   19 LINEAR   20 2
zdef   1 linear 1  1
tdef   999 linear jan1991 1mo
vars   2
regr  0 99 regression
reof  0 99 from acc
endvars
EOF

done
#
