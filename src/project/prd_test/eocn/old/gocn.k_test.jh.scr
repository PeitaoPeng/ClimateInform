#!/bin/sh
##########################################
# repeat JH's work
#########################################
set -eaux

lcdir=/cpc/home/wd52pp/project/prd_skill
tmp=/cpc/home/wd52pp/tmp
datadir=/cpc/home/wd52pp/data/prd_skill
#
last_yr=1993
longtime=63
ntprd=33  # ntprd=longtime-30
mode=6  #cut off modes
var=temp
#KP=15  #for prec
KP=30  #for temp
irms=0
metrics=acc

#
if [ "irms" = 1 ]; then metrics=rms; fi
#
/bin/rm $tmp/*.*         
cp $lcdir/gocn.k_test.jh.f $tmp/gocn.k_test.f
cp $lcdir/reof.s.f $tmp/reof.s.f
cd $tmp
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(mmax=$mode)
       parameter(ntprd=$ntprd,kp=$KP)
       parameter(ndec=4)
       parameter(irms=$irms)
eof
#
gfortran -o gocn.k_test.x reof.s.f gocn.k_test.f
echo "done compiling"

#
 ln -s /cpc/home/wd52pp/data/LF_prd/${var}_102.txt      fort.10
#
 ln -s $datadir/gocn.skill_vs_k.jh.$metrics.gr   fort.60
#
gocn.k_test.x > $datadir/gocn.k_test.jh.$metrics.out
#
#/bin/rm $tmp/fort.*         
#
cat>$datadir/gocn.skill_vs_k.jh.$metrics.ctl<<EOF
dset $datadir/gocn.skill_vs_k.jh.$metrics.gr
undef 999.0
title Realtime Surface Obs
xdef   $KP  linear  1  1
ydef   1 linear  0.000  1
zdef   1 levels 500
tdef $ntprd linear jan1991  1yr
vars   2
$metrics   0 99 metrics
wmo   0 99 rms of wmo clim
endvars
EOF
