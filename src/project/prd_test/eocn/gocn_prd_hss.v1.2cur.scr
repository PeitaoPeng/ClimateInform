#!/bin/sh
########################################
#  K is fixed to be 10
########################################

set -eaux

lcdir=/export/hobbes/wd52pp/project/prd_skill
tmp=/export/hobbes/wd52pp/tmp
datadir=/export-12/cacsrv1/wd52pp/prd_skill
#
last_yr=2010
longtime=80
ntprd=50  # ntprd=longtime-30
mode=6
KP=10
#
/bin/rm $tmp/*.*         
cp $lcdir/gocn_prd_hss.v1.f $tmp/gocn_prd_hss.f
cp $lcdir/reof.s.f $tmp/reof.s.f
cd $tmp
 for season in jfm fma mam amj mjj jja jas aso son ond ndj djf; do
#for season in jfm; do
#
if [ "$season" = jfm ]; then mons=1; fi
if [ "$season" = fma ]; then mons=2; fi
if [ "$season" = mam ]; then mons=3; fi
if [ "$season" = amj ]; then mons=4; fi
if [ "$season" = mjj ]; then mons=5; fi
if [ "$season" = jja ]; then mons=6; fi
if [ "$season" = jas ]; then mons=7; fi
if [ "$season" = aso ]; then mons=8; fi
if [ "$season" = son ]; then mons=9; fi
if [ "$season" = ond ]; then mons=10; fi
if [ "$season" = ndj ]; then mons=11; fi
if [ "$season" = djf ]; then mons=12; fi
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(iseason=$mons)
       parameter(mmax=$mode)
       parameter(ntprd=$ntprd,kp=$KP)
       parameter(ndec=5)
eof
#
#
f77 -o gocn_prd_hss.x reof.s.f gocn_prd_hss.f
echo "done compiling"

#
 ln -s /export-12/cacsrv1/wd52pp/LF_prd/temp_102.2cur.txt      fort.10
 ln -s $datadir/wmoobs_temp.$season.1991-$last_yr.i3e     fort.20  #normalized 
 ln -s $datadir/gocnv1prd_temp.$season.1991-$last_yr.i3e    fort.25  #normalized
 ln -s $datadir/gocnv1prd_hss_temp.$season.1991-$last_yr.gr   fort.40
 ln -s $datadir/gocnv1prd_temp.$season.1991-$last_yr.non-norm.gr   fort.50
#
gocn_prd_hss.x > $datadir/gocnv1prd_hss.$season.out
#
/bin/rm $tmp/fort.*         

cat>$datadir/gocnv1prd_hss_temp.$season.1991-$last_yr.ctl<<EOF
dset $datadir/gocnv1prd_hss_temp.$season.1991-$last_yr.gr
undef 999.0
title Realtime Surface Obs
xdef    1 linear    0.000  1
ydef    1 linear    0.000  1
zdef    1 levels 500
tdef $ntprd linear jan1991  1yr
vars   1
hs   0 99 hss
endvars
EOF
done
