#!/bin/sh

set -eaux

lcdir=/cpc/home/wd52pp/project/prd_test/ocn_cmp
tmp=/cpc/home/wd52pp/tmp
datadir=/cpc/home/wd52pp/data/prd_test
#
last_yr=2012
longtime=82
ntprd=52  # ntprd=longtime-30
mode=8
mrot=8
var=temp
#kp=17 #for temp
kp=30 #for temp
ndec=6
irms=1 #=0 for acc metrics
metrics=rms  # =acc if irms=0
#
cp $lcdir/eocn_prd_skill.f $tmp/eocnprd_skill.f
cp $lcdir/reof.s.f $tmp/reof.s.f
cp $lcdir/CD102_2_2x2.s.f $tmp/CD102_2_2x2.s.f
cd $tmp
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(mmax=$mode)
       parameter(mrot=$mrot)   !mode # to rotate
       parameter(ntprd=$ntprd)
       parameter(kp=$kp)
       parameter(ndec=$ndec)  !# of wmo clim for the whole data length
       parameter(irms=$irms)
eof
#
gfortran -o eocnprd_skill.x reof.s.f CD102_2_2x2.s.f eocnprd_skill.f
echo "done compiling"
#
/bin/rm $tmp/fort.*         
#
#
 ln -s /cpc/home/wd52pp/data/LF_prd/${var}_102.txt          fort.10
#
 ln -s $datadir/eocn.ocn.vs.mod_ss_t.$metrics.gr     fort.60
 ln -s $datadir/eocn.acc_t.vs.cd_ss.$metrics.gr    fort.61
 ln -s $datadir/eocn.acc_s.vs.ss_t.$metrics.gr     fort.62
 ln -s $datadir/eocnprd_rpc.1961-$last_yr.$metrics.gr   fort.63
#
eocnprd_skill.x > $datadir/eocnprd_skill.$metrics.out
#
cat>$datadir/eocn.ocn.vs.mod_ss_t.$metrics.ctl<<EOF
dset $datadir/eocn.ocn.vs.mod_ss_t.$metrics.gr
undef 999.0
title Realtime Surface Obs
xdef   $mode linear  1  1
ydef   1 linear  1  1
zdef   1 linear 1  1
tdef 999 linear jan1991 1mo
vars   1
k  0 99 eocn on CDs
endvars
EOF
#
cat>$datadir/eocn.acc_t.vs.cd_ss.$metrics.ctl<<EOF
dset $datadir/eocn.acc_t.vs.cd_ss.$metrics.gr
UNDEF  -9999.0
TITLE skill
xdef   36 linear -130 2
ydef   19 LINEAR   20 2
zdef   1 linear 1  1
tdef 12 linear jan1991 1mo
vars   1
ac  0 99 from K(mode,ss,t)
endvars
EOF
#
cat>$datadir/eocn.acc_s.vs.ss_t.$metrics.ctl<<EOF
dset $datadir/eocn.acc_s.vs.ss_t.$metrics.gr
undef 999.0
title 1-d ac skill
xdef   1 linear  1  1
ydef   1 linear  1  1
zdef   1 linear 1  1
tdef   999 linear jan1991 1mo
vars   1
ac  0 99 from K(mode,ss,t)
endvars
EOF
#
cat>$datadir/eocnprd_rpc.1961-$last_yr.$metrics.ctl<<EOF2
dset $datadir/eocnprd_rpc.1961-$last_yr.$metrics.gr
undef 999.0
title Realtime Surface Obs
xdef    1 linear    0.000  1
ydef    1 linear    0.000  5
zdef    1 levels 500
tdef 999 linear jan1961 1yr
vars   16
p1   0 99 rpc1 of prd
v1   0 99 rpc1 of obs
p2   0 99 rpc2 of t2m
v2   0 99 rpc2 of t2m
p3   0 99 rpc3 of t2m
v3   0 99 rpc3 of t2m
p4   0 99 rpc4 of t2m
v4   0 99 rpc4 of t2m
p5   0 99 rpc5 of t2m
v5   0 99 rpc5 of t2m
p6   0 99 rpc6 of t2m
v6   0 99 rpc6 of t2m
p7   0 99 rpc6 of t2m
v7   0 99 rpc6 of t2m
p8   0 99 rpc6 of t2m
v8   0 99 rpc6 of t2m
endvars
EOF2
#
