#!/bin/sh
##########################################
# As ltime=60(1960) to 81(2011) see how K change
# dependt on season(ss) and climate division
#########################################
set -eaux

lcdir=/cpc/home/wd52pp/project/prd_test/ocn_cmp
tmp=/cpc/home/wd52pp/tmp
datadir=/cpc/home/wd52pp/data/prd_test
#
last_yr=2012
longtime=82
ntprd=52  # ntprd=longtime-30
ntout=22  # ntprd=longtime-60
mode=6    #cut off modes
ndec=6    #cut off modes
var=temp
KP=30  #for temp
irms=1 #=0 for acc metrics
metrics=rms  # =acc if irms=0

#
if [ "irms" = 1 ]; then metrics=rms; fi
#
/bin/rm $tmp/*.*         
cp $lcdir/gocn.k_vs_t.ss_cd.f $tmp/gocn.k_test.f
cp $lcdir/reof.s.f $tmp/reof.s.f
cp $lcdir/CD102_2_2x2.s.f $tmp/CD102_2_2x2.s.f
cd $tmp
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(mmax=$mode)
       parameter(ntprd=$ntprd,kp=$KP)
       parameter(ntout=$ntout)
       parameter(ndec=$ndec)
       parameter(irms=$irms)
eof
#
gfortran -o gocn.k_test.x reof.s.f CD102_2_2x2.s.f gocn.k_test.f
echo "done compiling"

#
 ln -s /cpc/home/wd52pp/data/LF_prd/${var}_102.txt      fort.10
#
 ln -s $datadir/gocn.ocn.vs.cd_ss_t.$metrics.2x2.gr   fort.60
 ln -s $datadir/gocn.acc_t.vs.cd_ss.$metrics.gr   fort.61
 ln -s $datadir/gocn.acc_s.vs.ss_t.$metrics.gr   fort.62
 ln -s $datadir/gocn.prd.$metrics.gr   fort.63
 ln -s $datadir/gocn.ocn.vs.cd_ss_t.$metrics.gr   fort.64
#
gocn.k_test.x > $datadir/gocn.k_vs_tlong.$metrics.ss_cd.out
#
#/bin/rm $tmp/fort.*         
#
cat>$datadir/gocn.ocn.vs.cd_ss_t.$metrics.2x2.ctl<<EOF
dset $datadir/gocn.ocn.vs.cd_ss_t.$metrics.2x2.gr
undef -9999.0
title Realtime Surface Obs
xdef   36 linear -130 2
ydef   19 LINEAR   20 2
zdef   1 linear 1  1
tdef 999 linear jan1991 1mo
vars   1
k  0 99 ocn on CDs
endvars
EOF
#
cat>$datadir/gocn.ocn.vs.cd_ss_t.$metrics.ctl<<EOF
dset $datadir/gocn.ocn.vs.cd_ss_t.$metrics.gr
undef -9999.0
title Realtime Surface Obs
xdef  102 Linear -130 2
ydef    1 LINEAR   20 2
zdef    1 linear 1  1
tdef 999 linear jan1991 1mo
vars   12
k1  0 99 jfm ocn on CDs
k2  0 99 fma ocn on CDs
k3  0 99 mam ocn on CDs
k4  0 99 amj ocn on CDs
k5  0 99 mjj ocn on CDs
k6  0 99 jja ocn on CDs
k7  0 99 jas ocn on CDs
k8  0 99 aso ocn on CDs
k9  0 99 son ocn on CDs
k10  0 99 ond ocn on CDs
k11  0 99 ndj ocn on CDs
k12  0 99 djf ocn on CDs
endvars
EOF
#
cat>$datadir/gocn.acc_t.vs.cd_ss.$metrics.ctl<<EOF
dset $datadir/gocn.acc_t.vs.cd_ss.$metrics.gr
undef -9999.0
title 2d ac skill
xdef   36 linear -130 2
ydef   19 LINEAR   20 2
zdef   1 linear 1  1
tdef 12 linear jan1991 1mo
vars   6
acc   0 99 from K(cd,ss,t)
rms   0 99 from K(cd,ss,t)
acc15  0 99 from K=15
rms15  0 99 from K=15
acc10  0 99 from K=10
rms10  0 99 from K=10
endvars
EOF
#
cat>$datadir/gocn.acc_s.vs.ss_t.$metrics.ctl<<EOF
dset $datadir/gocn.acc_s.vs.ss_t.$metrics.gr
undef -9999.0
title 1-d ac skill
xdef   1 linear  1  1
ydef   1 linear  1  1
zdef   1 linear 1  1
tdef   999 linear jan1991 1mo
vars   6
acc  0 99 from K(cd,ss,t)
rms  0 99 from K(cd,ss,t)
acc15  0 99 from K=15
rms15  0 99 from K=15
acc10  0 99 from K=10
rms10  0 99 from K=10
endvars
EOF
#
cat>$datadir/gocn.prd.$metrics.ctl<<EOF
dset $datadir/gocn.prd.$metrics.gr
undef -9999.0
title 2d ac skill
xdef   36 linear -130 2
ydef   19 LINEAR   20 2
zdef   1 linear 1  1
tdef 999 linear jan1991 1mo
vars   4
p    0 99 from K(cd,ss,t)
p15  0 99 from K=15
p10  0 99 from K=10
obs  0 99 from K=10
endvars
EOF
#
