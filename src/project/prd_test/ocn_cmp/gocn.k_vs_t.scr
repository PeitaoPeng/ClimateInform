#!/bin/sh
##########################################
# As ltime=60(1960) to 81(2011) see how K change
# Independt of season(ss) and climate division
#########################################
set -eaux

lcdir=/cpc/home/wd52pp/project/prd_test/ocn_cmp
tmp=/cpc/home/wd52pp/tmp
datadir=/cpc/home/wd52pp/data/prd_test
#
last_yr=2012
longtime=82
ntprd=52  # ntprd=longtime-30
ntout=22  # ntprd=longtime-60
mode=6    #cut off modes
ndec=6    #cut off modes
var=temp
KP=30  #for temp
irms=1 #=0 for acc metrics
metrics=rms  # =acc if irms=0

#
if [ "irms" = 1 ]; then metrics=rms; fi
#
/bin/rm $tmp/*.*         
cp $lcdir/gocn.k_vs_t.f $tmp/gocn.k_test.f
cp $lcdir/reof.s.f $tmp/reof.s.f
cd $tmp
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(mmax=$mode)
       parameter(ntprd=$ntprd,kp=$KP)
       parameter(ntout=$ntout)
       parameter(ndec=$ndec)
       parameter(irms=$irms)
eof
#
gfortran -o gocn.k_test.x reof.s.f gocn.k_test.f
echo "done compiling"

#
 ln -s /cpc/home/wd52pp/data/LF_prd/${var}_102.txt      fort.10
#
 ln -s $datadir/gocn.skill_vs_k.$metrics.gr   fort.60
 ln -s $datadir/gocn.k_vs_t.$metrics.gr   fort.65
 ln -s $datadir/gocn.skill_vs_k.1991-cur.gr   fort.70
 ln -s $datadir/temp.usavg.jfm1961-djf2012.gr   fort.75
#
gocn.k_test.x > $datadir/gocn.k_vs_t.$metrics.out
#
#/bin/rm $tmp/fort.*         
#
cat>$datadir/gocn.skill_vs_k.$metrics.ctl<<EOF
dset $datadir/gocn.skill_vs_k.$metrics.gr
undef 999.0
title Realtime Surface Obs
xdef   $KP  linear  1  1
ydef   1 linear  0.000  1
zdef   1 levels 500
tdef $ntout linear jan1991  1yr
vars   2
$metrics   0 99 metrics
wmo   0 99 rms of wmo clim
endvars
EOF
#
cat>$datadir/gocn.k_vs_t.$metrics.ctl<<EOF
dset $datadir/gocn.k_vs_t.$metrics.gr
undef 999.0
title Realtime Surface Obs
xdef   $ntout  linear  1  1
ydef   1 linear  1  1
zdef   1 levels 500
tdef 999 linear jan1991  1yr
vars   3
k          0 99 ocn
$metrics   0 99 dependent skill
wmo        0 99 wmo rms
endvars
EOF
#
cat>$datadir/gocn.skill_vs_k.1991-cur.ctl<<EOF
dset $datadir/gocn.skill_vs_k.1991-cur.gr
undef 999.0
title Realtime Surface Obs
xdef   $KP  linear  1  1
ydef   1 linear  0.000  1
zdef   1 levels 500
tdef   1 linear jan1991  1yr
vars   3
acc   0 99 acc
rms   0 99 rms
wmo   0 99 rms of wmo clim
endvars
EOF
#
cat>$datadir/temp.usavg.jfm1961-djf2012.ctl<<EOF
dset $datadir/temp.usavg.jfm1961-djf2012.gr
undef 999.0
title Realtime Surface Obs
xdef   1 linear  1  1
ydef   1 linear  0.000  1
zdef   1 levels 500
tdef 9999 linear jan1961  1mon
vars   1
t  0 99  anom wrt wmo clim
endvars
EOF
#
