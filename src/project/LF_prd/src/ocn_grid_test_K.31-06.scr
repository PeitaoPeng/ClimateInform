#!/bin/sh

set -eaux

lcdir=/export/hobbes/wd52pp/project/LF_prd/src
tmp=/export/hobbes/wd52pp/tmp
datadir=/export-12/cacsrv1/wd52pp/LF_prd
#
longtime=76
ntprd=46
ngrd=102
season=djf
#
/bin/rm $tmp/*.*         
cp $lcdir/ocn_grid_test_K.31-06.f $tmp/.
cd $tmp
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(ntprd=$ntprd)
       parameter(ngrd=$ngrd)
eof
#
#
f77 -o ocn_grid_test_K.31-06.x ocn_grid_test_K.31-06.f
echo "done compiling"

#
 ln -s $datadir/temp_102_anom.$season.txt              fort.10
#ln -s $datadir/temp_102_anom_1931-2001.djf.eof_rcstct.txt   fort.10
 ln -s /export/hobbes/wd52pp/project/LF_prd/src/out          fort.20
 ln -s $datadir/K_AC_temp_102_anom_31-07.$season.i3e         fort.30
#
ocn_grid_test_K.31-06.x
#
source1=/export/hobbes/wd52pp/project/LF_prd/plot_cd
source2=/export/hobbes/wd52pp/project/LF_prd/ocn_prd/plot
#
cat>$source1/K_AC_temp_102_anom_31-07.$season.ctl<<EOF
dset $datadir/K_AC_temp_102_anom_31-07.$season.gr
dtype station
options sequential
stnmap $datadir/K_AC_temp_102_anom_31-07.$season.map
undef 10e10
title Realtime Surface Obs
tdef 1 linear 00z01jan1998  1hr
vars   1
z   0 0 Type of Ob
endvars
EOF
#
#===convert data to grads file
#
cd $source1/convert
#
cat > parm.h << eof
       parameter(nyear=1)
eof
#
#rm fort.*

f77 -o cd_2_grads.x cd_2_grads.f

   ln -s      $datadir/K_AC_temp_102_anom_31-07.$season.i3e          fort.11
#
   ln -s      $source1/convert/data_102/lalo102       fort.12

#
   ln -s      $datadir/K_AC_temp_102_anom_31-07.$season.gr    fort.55

   cd_2_grads.x
   rm fort.*

 stnmap -i $source1/K_AC_temp_102_anom_31-07.$season.ctl         #create map file
rm *.x
done

exit
