#!/bin/sh

set -eaux

lcdir=/export/hobbes/wd52pp/project/LF_prd/ocn_prd
tmp=/export/hobbes/wd52pp/tmp
datadir=/export-12/cacsrv1/wd52pp/LF_prd
#
longtime=76
mode=6
#
cp $lcdir/ocn_prd_pc.102cd.test.f $tmp/ocn_prd_pc.102cd.f
#
 for season in djf; do
#
cd $tmp
#
if [ "$season" = jfm ]; then mons=1; fi
if [ "$season" = fma ]; then mons=2; fi
if [ "$season" = mam ]; then mons=3; fi
if [ "$season" = amj ]; then mons=4; fi
if [ "$season" = mjj ]; then mons=5; fi
if [ "$season" = jja ]; then mons=6; fi
if [ "$season" = jas ]; then mons=7; fi
if [ "$season" = aso ]; then mons=8; fi
if [ "$season" = son ]; then mons=9; fi
if [ "$season" = ond ]; then mons=10; fi
if [ "$season" = ndj ]; then mons=11; fi
if [ "$season" = djf ]; then mons=12; fi
#
cat > parm.h << eof
       parameter(ltime=$longtime)
       parameter(imax=102)
       parameter(mmax=$mode)
       parameter(ntprd=ltime-30)
       parameter(iseason=$mons)
eof
#
/bin/rm $tmp/fort.*         
f77 -o ocn_prd_pc.x ocn_prd_pc.102cd.f
echo "done compiling"
#
 ln -s $datadir/temp_102_anom.$season.txt        fort.30
 ln -s $datadir/coef.temp_102_anom.$season.i3e  fort.10
 ln -s $datadir/regr.temp_102_anom.$season.i3e   fort.15
 ln -s $datadir/ocn_pc_prd_temp.$season.test.i3e     fort.20
 ln -s $datadir/ocn_prd_and_vrfy_tcoef.$season.test.i3e     fort.25
 ln -s $datadir/2mt.wmoanom.$season.test.txt                fort.35
 ln -s $datadir/eocn.2mt.$season.test.txt                   fort.40
#
ocn_prd_pc.x
#
cat>$lcdir/plot/ocn_pc_prd_temp.$season.test.ctl<<EOF
dset /export-12/cacsrv1/wd52pp/LF_prd/ocn_pc_prd_temp.$season.test.gr
dtype station
options sequential
stnmap /export-12/cacsrv1/wd52pp/LF_prd/ocn_pc_prd_temp.$season.test.map
undef 10e10
title Realtime Surface Obs
tdef 4 linear 00z01jan1998  1hr
vars   1
z   0 0 Type of Ob
endvars
EOF
#
#===convert data to grads file
#
source1=/export/hobbes/wd52pp/project/LF_prd/plot_cd
source2=/export/hobbes/wd52pp/project/LF_prd/ocn_prd/plot

cd $source1/convert

#
cat > parm.h << eof
       parameter(nyear=4)
eof
#
#rm fort.*

f77 -o cd_2_grads.x cd_2_grads.f

   ln -s      $datadir/ocn_pc_prd_temp.$season.test.i3e          fort.11
#
   ln -s      $source1/convert/data_102/lalo102       fort.12

#
   ln -s      $datadir/ocn_pc_prd_temp.$season.test.gr    fort.55

   cd_2_grads.x
   rm fort.*

 stnmap -i $source2/ocn_pc_prd_temp.$season.test.ctl         #create map file

rm *.x
done

exit
