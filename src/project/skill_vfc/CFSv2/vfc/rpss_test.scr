#!/bin/sh

set -eaux

# test the significance of the diff between CFSv1 and CFSv2 for RPSS 
 
lcdir=/cpc/home/wd52pp/project/CFSv2_skill/vfc
tmp=/cpc/home/wd52pp/tmp
datadir1=/cpc/home/wd52pp/data/CFSv2_vfc/0data
datadir4=/cpc/home/wd52pp/data/CFS_vfc/0data
datadir2=/cpc/home/wd52pp/data/CFSv2_vfc/skill
datadir3=/cpc/home/wd52pp/data/cpc_vfc/0data
#
#stype=mix  #sampling type, mix=mix 2 models
 stype=no_mix # no_mix=mix 2 models
#var=temp
 var=prec
nseason=180
nyears=15
nsp=10000  # sample size of MC
nupbnd=9750 # upper bnd of 95%
#
/bin/rm $tmp/fort.*         
cp $lcdir/rpss_test.$stype.f $tmp/rpss_test.f
cd $tmp
#
cat > parm.h << eof
       parameter(nss=$nseason)
       parameter(nyr=$nyears)
       parameter(imx=36,jmx=19)
       parameter(nsp=$nsp,nbnd=$nupbnd)
eof
#
#
gfortran -o rpss.x rpss_test.f
echo "done compiling"

#
 ln -s $datadir1/mask_2x2.data    fort.11
 ln -s $datadir1/${var}.jfm95-djf09.cfsv2.below.gr   fort.12
 ln -s $datadir1/${var}.jfm95-djf09.cfsv2.above.gr   fort.13
 ln -s $datadir4/${var}.jfm95-jfm11.cfs.below.gr     fort.22
 ln -s $datadir4/${var}.jfm95-jfm11.cfs.above.gr     fort.23
 ln -s $datadir3/${var}_seas_verif.bi                fort.14
 ln -s $datadir2/rpss_test.${var}.95-cur.cfsv1_v2.$stype.gr  fort.51
#
rpss.x > $lcdir/test_out.$stype.$var
#

cat>$datadir2/rpss_test.${var}.95-cur.cfsv1_v2.$stype.ctl<<EOF
dset ^rpss_test.${var}.95-cur.cfsv1_v2.$stype.gr
undef -9999.0
title Realtime Surface Obs
xdef   36 linear -130 2
ydef   19 LINEAR   20 2
zdef    1 levels 500
tdef 999 linear jan1995  1mon
vars   9
rpssv2   0 99 for CFSv2
rpssv1   0 99 for CFSv1
df12     0 99 for v2-v1
bnd2     0 99 upper bnd for v2
bnd1     0 99 upper bnd for v1
bnddf    0 99 upper bnd for v2-v1
nsig2    0 99 significant mask(=1) for v2
nsig1    0 99 significant mask(=1) for v1
nsigdf    0 99 significant mask(=1) for v2-v1
endvars
EOF
