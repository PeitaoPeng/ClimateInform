#!/bin/sh

set -eaux

lcdir=/export/hobbes/wd52pp/project/attr/plot
tmp=/export/hobbes/wd52pp/tmp
datadir=/export-12/cacsrv1/wd52pp/attr
var=prec
#
season=djf
tgt_season=DJF
#
cd $tmp
#
#======================================
# plot global map 
#======================================
cat >ensocmp_map<<EOF1
run global.gs
EOF1

cat >global.gs<<EOF2
* prec in global
    'reinit'
    'set display color white'
    'c'
    'run /export/hobbes/wd52pp/bin/rgbset.gs'
*
'open $datadir/prec.ensocmp.$season.ctl'
*---------------------------string/caption
 'set string 1 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 5.5 8. $tgt_season Prate Anom from ENSO Composite'
 'set string 4 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 2.75 7.5 composite(K)'
 'draw string 8.25 7.5 frequency(%)'
 'draw string 5.5  7.1 Strong El Nino'
 'draw string 5.5  3.6 strong La Nina'
*---------------------------set dimsnesion, page size and style
'cp1=cmp1'
'cp2=cmp5'
'cp3=frq1'
'cp4=frq5'
*
nframe=4
nframe2=2
nframe3=4
xmin0=0.5;  xlen=4.75;  xgap=0.5
ymax0=7.; ylen=-2.7;  ygap=-0.8
*
iframe=1
while ( iframe <= nframe )
  icx=1; if (iframe > nframe2); icx=2; endif
  if (iframe > nframe3); icx=3; endif
  xmin=xmin0+(icx-1)*(xlen+xgap)
  xmax=xmin+xlen
  icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
  if (iframe > nframe3); icy=iframe-nframe3; endif
  ymax=ymax0+(icy-1)*(ylen+ygap)
  ymin=ymax+ylen
  titlx=xmin+2.375
  titly=ymax
  barx=xmin+2.375
  bary=ymin-0.2
* say xmin; say xmax; say ymin; say ymax
  'set vpage 0 11 0 8.5'
  'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 20'
'set xlint 60'
*
'set lat -60 80'
'set lon 0 360'
'set grads off'
'set grid off'
'set poli on'
'set mpdset mres'
'set gxout grfill'
*
if(iframe < 3);
'set clevs  -4. -2. -1.0 -0.5 -0.25 0.25 0.5 1.0 2. 4.'
'set ccols  79 77 75 73 71 0 31 33 35 37 39 '
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
if(iframe > 2);
'set clevs  30 40 50 60 70 80 90'
'set ccols  0 21 22 23 24 25 27 29'
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
iframe=iframe+1
endwhile
'printim $datadir/$var.strong_cmp.$tgt_season.gl.png gif x800 y600'
'print'
*
    'reinit'
    'set display color white'
    'c'
    'run /export/hobbes/wd52pp/bin/rgbset.gs'
*
'open $datadir/prec.ensocmp.$season.ctl'
*---------------------------string/caption
 'set string 1 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 5.5 8.3 $tgt_season Prate Anom from ENSO Composite'
 'set string 4 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 2.75 7.8 composite(K)'
 'draw string 8.25 7.8 frequency(%)'
 'draw string 5.5  7.5 Strong El Nino'
 'draw string 5.5  3.7 strong La Nina'
*---------------------------set dimsnesion, page size and style
'cp1=cmp1'
'cp2=cmp5'
'cp3=frq1'
'cp4=frq5'
*
nframe=4
nframe2=2
nframe3=4
xmin0=0.5;  xlen=4.75;  xgap=0.5
ymax0=7.25; ylen=-2.7;  ygap=-1.1
*
iframe=1
while ( iframe <= nframe )
  icx=1; if (iframe > nframe2); icx=2; endif
  if (iframe > nframe3); icx=3; endif
  xmin=xmin0+(icx-1)*(xlen+xgap)
  xmax=xmin+xlen
  icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
  if (iframe > nframe3); icy=iframe-nframe3; endif
  ymax=ymax0+(icy-1)*(ylen+ygap)
  ymin=ymax+ylen
  titlx=xmin+2.375
  titly=ymax
  barx=xmin+2.375
  bary=ymin-0.4
* say xmin; say xmax; say ymin; say ymax
  'set vpage 0 11 0 8.5'
  'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 10'
'set xlint 20'
*
'set lat 15 75'
'set lon 190 310'
*
'set grads off'
'set grid off'
'set poli on'
'set mpdset mres'
'set gxout grfill'
*
if(iframe < 3);
'set clevs  -4. -2. -1.0 -0.5 -0.25 0.25 0.5 1.0 2. 4.'
'set ccols  79 77 75 73 71 0 31 33 35 37 39 '
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
if(iframe > 2);
'set clevs  30 40 50 60 70 80 90'
'set ccols  0 21 22 23 24 25 27 29'
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
iframe=iframe+1
endwhile
'printim $datadir/$var.strong_cmp.$tgt_season.na.png gif x800 y600'
'print'
*
    'reinit'
    'set display color white'
    'c'
    'run /export/hobbes/wd52pp/bin/rgbset.gs'
*
'open $datadir/prec.ensocmp.$season.ctl'
*---------------------------string/caption
 'set string 1 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 5.5 8. $tgt_season Prate Anom from ENSO Composite'
 'set string 4 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 2.75 7.5 composite(K)'
 'draw string 8.25 7.5 frequency(%)'
 'draw string 5.5  7.1 weak&moderate El Nino'
 'draw string 5.5  3.6 weak&moderate La Nina'
*---------------------------set dimsnesion, page size and style
'cp1=cmp2'
'cp2=cmp4'
'cp3=frq2'
'cp4=frq4'
*
nframe=4
nframe2=2
nframe3=4
xmin0=0.5;  xlen=4.75;  xgap=0.5
ymax0=7.; ylen=-2.7;  ygap=-0.8
*
iframe=1
while ( iframe <= nframe )
  icx=1; if (iframe > nframe2); icx=2; endif
  if (iframe > nframe3); icx=3; endif
  xmin=xmin0+(icx-1)*(xlen+xgap)
  xmax=xmin+xlen
  icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
  if (iframe > nframe3); icy=iframe-nframe3; endif
  ymax=ymax0+(icy-1)*(ylen+ygap)
  ymin=ymax+ylen
  titlx=xmin+2.375
  titly=ymax
  barx=xmin+2.375
  bary=ymin-0.2
* say xmin; say xmax; say ymin; say ymax
  'set vpage 0 11 0 8.5'
  'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 20'
'set xlint 60'
*
'set lat -60 80'
'set lon 0 360'
'set grads off'
'set grid off'
'set poli on'
'set mpdset mres'
'set gxout grfill'
*
if(iframe < 3);
ymax0=7.; ylen=-2.7;  ygap=-0.8
*
iframe=1
while ( iframe <= nframe )
icx=1; if (iframe > nframe2); icx=2; endif
if (iframe > nframe3); icx=3; endif
xmin=xmin0+(icx-1)*(xlen+xgap)
xmax=xmin+xlen
icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
if (iframe > nframe3); icy=iframe-nframe3; endif
ymax=ymax0+(icy-1)*(ylen+ygap)
ymin=ymax+ylen
titlx=xmin+2.375
titly=ymax
barx=xmin+2.375
bary=ymin-0.2
* say xmin; say xmax; say ymin; say ymax
'set vpage 0 11 0 8.5'
'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 20'
'set xlint 60'
*
'set lat -60 80'
'set lon 0 360'
'set grads off'
'set grid off'
'set poli on'
'set mpdset mres'
'set gxout grfill'
*
if(iframe < 3);
'set clevs  -4. -2. -1.0 -0.5 -0.25 0.25 0.5 1.0 2. 4.'
'set ccols  79 77 75 73 71 0 31 33 35 37 39 '
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
endif
*
if(iframe > 2);
'set clevs  30 40 50 60 70 80 90'
'set ccols  0 21 22 23 24 25 27 29'
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
endif
*
iframe=iframe+1
endwhile
'printim $datadir/$var.strong_cmp.$tgt_season.gl.png gif x800 y600'
'print'
*
'reinit'
'set display color white'
'c'
'run /export/hobbes/wd52pp/bin/rgbset.gs'
*
'open $datadir/prec.ensocmp.$season.ctl'
*---------------------------string/caption
'set string 1 tc 4'
'set strsiz 0.15 0.15'
'draw string 5.5 8.3 $tgt_season Prate Anom from ENSO Composite'
'set string 4 tc 4'
'set strsiz 0.15 0.15'
'draw string 2.75 7.8 composite(K)'
'draw string 8.25 7.8 frequency(%)'
'draw string 5.5  7.5 Strong El Nino'
'draw string 5.5  3.7 strong La Nina'
*---------------------------set dimsnesion, page size and style
'cp1=cmp1'
'cp2=cmp5'
'cp3=frq1'
'cp4=frq5'
*
nframe=4
nframe2=2
nframe3=4
xmin0=0.5;  xlen=4.75;  xgap=0.5
ymax0=7.25; ylen=-2.7;  ygap=-1.1
*
iframe=1
while ( iframe <= nframe )
icx=1; if (iframe > nframe2); icx=2; endif
if (iframe > nframe3); icx=3; endif
xmin=xmin0+(icx-1)*(xlen+xgap)
xmax=xmin+xlen
icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
if (iframe > nframe3); icy=iframe-nframe3; endif
ymax=ymax0+(icy-1)*(ylen+ygap)
ymin=ymax+ylen
titlx=xmin+2.375
titly=ymax
barx=xmin+2.375
bary=ymin-0.4
* say xmin; say xmax; say ymin; say ymax
'set vpage 0 11 0 8.5'
'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 10'
'set xlint 20'
*
'set lat 15 75'
'set lon 190 310'
*
'set grads off'
'set grid off'
'set poli on
ymax0=7.; ylen=-2.7;  ygap=-0.8
*
iframe=1
while ( iframe <= nframe )
icx=1; if (iframe > nframe2); icx=2; endif
if (iframe > nframe3); icx=3; endif
xmin=xmin0+(icx-1)*(xlen+xgap)
xmax=xmin+xlen
icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
if (iframe > nframe3); icy=iframe-nframe3; endif
ymax=ymax0+(icy-1)*(ylen+ygap)
ymin=ymax+ylen
titlx=xmin+2.375
titly=ymax
barx=xmin+2.375
bary=ymin-0.2
* say xmin; say xmax; say ymin; say ymax
'set vpage 0 11 0 8.5'
'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 20'
'set xlint 60'
*
'set lat -60 80'
'set lon 0 360'
'set grads off'
'set grid off'
'set poli on'
'set mpdset mres'
'set gxout grfill'
*
if(iframe < 3);
'set clevs  -4. -2. -1.0 -0.5 -0.25 0.25 0.5 1.0 2. 4.'
'set ccols  79 77 75 73 71 0 31 33 35 37 39 '
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
endif
*
if(iframe > 2);
'set clevs  30 40 50 60 70 80 90'
'set ccols  0 21 22 23 24 25 27 29'
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
endif
*
iframe=iframe+1
endwhile
'printim $datadir/$var.strong_cmp.$tgt_season.gl.png gif x800 y600'
'print'
*
'reinit'
'set display color white'
'c'
'run /export/hobbes/wd52pp/bin/rgbset.gs'
*
'open $datadir/prec.ensocmp.$season.ctl'
*---------------------------string/caption
'set string 1 tc 4'
'set strsiz 0.15 0.15'
'draw string 5.5 8.3 $tgt_season Prate Anom from ENSO Composite'
'set string 4 tc 4'
'set strsiz 0.15 0.15'
'draw string 2.75 7.8 composite(K)'
'draw string 8.25 7.8 frequency(%)'
'draw string 5.5  7.5 Strong El Nino'
'draw string 5.5  3.7 strong La Nina'
*---------------------------set dimsnesion, page size and style
'cp1=cmp1'
'cp2=cmp5'
'cp3=frq1'
'cp4=frq5'
*
nframe=4
nframe2=2
nframe3=4
xmin0=0.5;  xlen=4.75;  xgap=0.5
ymax0=7.25; ylen=-2.7;  ygap=-1.1
*
iframe=1
while ( iframe <= nframe )
icx=1; if (iframe > nframe2); icx=2; endif
if (iframe > nframe3); icx=3; endif
xmin=xmin0+(icx-1)*(xlen+xgap)
xmax=xmin+xlen
icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
if (iframe > nframe3); icy=iframe-nframe3; endif
ymax=ymax0+(icy-1)*(ylen+ygap)
ymin=ymax+ylen
titlx=xmin+2.375
titly=ymax
barx=xmin+2.375
bary=ymin-0.4
* say xmin; say xmax; say ymin; say ymax
'set vpage 0 11 0 8.5'
'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 10'
'set xlint 20'
*
'set lat 15 75'
'set lon 190 310'
*
'set grads off'
'set grid off'
'set poli on
if(iframe < 3);
'set clevs  -4. -2. -1.0 -0.5 -0.25 0.25 0.5 1.0 2. 4.'
'set ccols  79 77 75 73 71 0 31 33 35 37 39 '
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
if(iframe > 2);
'set clevs  30 40 50 60 70 80 90'
'set ccols  0 21 22 23 24 25 27 29'
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
iframe=iframe+1
endwhile
'printim $datadir/$var.weak_cmp.$tgt_season.gl.png gif x800 y600'
'print'
*
    'reinit'
    'set display color white'
    'c'
    'run /export/hobbes/wd52pp/bin/rgbset.gs'
*
'open $datadir/prec.ensocmp.$season.ctl'
*---------------------------string/caption
 'set string 1 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 5.5 8.3 $tgt_season Prate Anom from ENSO Composite'
 'set string 4 tc 4'
 'set strsiz 0.15 0.15'
 'draw string 2.75 7.8 composite(K)'
 'draw string 8.25 7.8 frequency(%)'
 'draw string 5.5  7.5 weak&moderate El Nino'
 'draw string 5.5  3.7 weak&moderate La Nina'
*---------------------------set dimsnesion, page size and style
'cp1=cmp2'
'cp2=cmp4'
'cp3=frq2'
'cp4=frq4'
*
nframe=4
nframe2=2
nframe3=4
xmin0=0.5;  xlen=4.75;  xgap=0.5
ymax0=7.25; ylen=-2.7;  ygap=-1.1
*
iframe=1
while ( iframe <= nframe )
  icx=1; if (iframe > nframe2); icx=2; endif
  if (iframe > nframe3); icx=3; endif
  xmin=xmin0+(icx-1)*(xlen+xgap)
  xmax=xmin+xlen
  icy=iframe; if (iframe > nframe2); icy=iframe-nframe2; endif
  if (iframe > nframe3); icy=iframe-nframe3; endif
  ymax=ymax0+(icy-1)*(ylen+ygap)
  ymin=ymax+ylen
  titlx=xmin+2.375
  titly=ymax
  barx=xmin+2.375
  bary=ymin-0.4
* say xmin; say xmax; say ymin; say ymax
  'set vpage 0 11 0 8.5'
  'set parea 'xmin' 'xmax' 'ymin' 'ymax''
*
'set ylint 10'
'set xlint 20'
*
'set lat 15 75'
'set lon 190 310'
*
'set grads off'
'set grid off'
'set poli on'
'set mpdset mres'
'set gxout grfill'
*
if(iframe < 3);
'set clevs  -4. -2. -1.0 -0.5 -0.25 0.25 0.5 1.0 2. 4.'
'set ccols  79 77 75 73 71 0 31 33 35 37 39 '
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
if(iframe > 2);
'set clevs  30 40 50 60 70 80 90'
'set ccols  0 21 22 23 24 25 27 29'
'd cp'%iframe
'run /export/hobbes/wd52pp/bin/cbarn.gs 0.55 0 'barx' 'bary''
'set string 4 tc 4'
'set strsiz 0.14 0.14'
 endif
*
iframe=iframe+1
endwhile
'printim $datadir/$var.weak_cmp.$tgt_season.na.png gif x800 y600'
'print'
EOF2

/usr/local/bin/grads -l <ensocmp_map
cp $datadir/$var.weak_cmp.$tgt_season.gl.png /export/hobbes/wd52pp/data/maychen
cp $datadir/$var.weak_cmp.$tgt_season.na.png /export/hobbes/wd52pp/data/maychen
cp $datadir/$var.strong_cmp.$tgt_season.gl.png /export/hobbes/wd52pp/data/maychen
cp $datadir/$var.strong_cmp.$tgt_season.na.png /export/hobbes/wd52pp/data/maychen
