#!/bin/sh

set -eaux

lcdir=/cpc/home/wd52pp/project/ca_prd/sst/src
tmpdir=/cpc/home/wd52pp/tmp
if [ ! -d $tmpdir ] ; then
  mkdir -p $tmpdir
fi
analdir=/cpc/analysis/cdas/rot_6hrly
bindir=/cpc/home/wd52pp/bin
#
#================================================
# have IC daily SST from R1(CDAS) data
#================================================
#
cd $tmpdir
rm -f sstgrb*
#
YEAR=`date --date='8 day ago' '+%Y'`
MONTH=`date --date='8 day ago' '+%m'`
DAY=`date --date='8 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
YEAR=`date --date='7 day ago' '+%Y'`
MONTH=`date --date='7 day ago' '+%m'`
DAY=`date --date='7 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
YEAR=`date --date='6 day ago' '+%Y'`
MONTH=`date --date='6 day ago' '+%m'`
DAY=`date --date='6 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
YEAR=`date --date='5 day ago' '+%Y'`
MONTH=`date --date='5 day ago' '+%m'`
DAY=`date --date='5 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
YEAR=`date --date='4 day ago' '+%Y'`
MONTH=`date --date='4 day ago' '+%m'`
DAY=`date --date='4 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
YEAR=`date --date='3 day ago' '+%Y'`
MONTH=`date --date='3 day ago' '+%m'`
DAY=`date --date='3 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
YEAR=`date --date='2 day ago' '+%Y'`
MONTH=`date --date='2 day ago' '+%m'`
DAY=`date --date='2 day ago' '+%d'`
cp $analdir/sstgrb${YEAR}${MONTH}${DAY}00 $tmpdir
#
cat sstgrb* > sstgrball
$bindir/./wgrib sstgrball | egrep -e ":TMP:" | grep -e ":sfc:" | $bindir/./wgrib sstgrball -i -bin -o sstbin.gr
#
cat >sstbin.ctl<<EOF
dset ^sstbin.gr
undef 9.999E+20
options yrev
ydef 180 linear -89.5 1.0
xdef 360 linear  0.5 1.0
tdef 999 linear 01jan1079 1dy
zdef 1 linear 1 1
vars 1
TMP  0 33,100,200  daily oi sst from R1
ENDVARS
EOF
cat >readsst<<EOF
run read.gs
EOF
cat >read.gs<<EOF
'reinit'
'open sstbin.ctl'
'set x 1 360'
'set y 1 180'
'set gxout fwrite'
'set fwrite sst.gr'
'set t 1 7'
'd TMP'
'c'
EOF
$bindir/grads -bl <readsst
# 
