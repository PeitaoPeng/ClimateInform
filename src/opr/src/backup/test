function draw_tercile_legend(x1,y1,x2,y2)

* x1,y1 = lower-left corner of legend box
* x2,y2 = upper-right corner

* ----------------------------------------------------
* 1. DEFINE COLORS (CPC-style)
* ----------------------------------------------------
* Below-normal (blue)
set rgb 21 198 219 255
set rgb 22 115 178 255
set rgb 23  40 120 255

* Near-normal (gray)
set rgb 24 220 220 220

* Above-normal (red)
set rgb 25 255 200 180
set rgb 26 255 120 120
set rgb 27 255  40  40

* ----------------------------------------------------
* 2. INTERNAL GEOMETRY
* ----------------------------------------------------
* Three bars stacked vertically
h = (y2 - y1) / 3
b1y1 = y2 - h
b1y2 = y2
b2y1 = y2 - 2*h
b2y2 = y2 - h
b3y1 = y1
b3y2 = y1 + h

* Probability bin boundaries (fractions of bar width)
* 33–40–50–60–70–100
p = {0.00, 0.20, 0.40, 0.60, 0.80, 1.00}

* ----------------------------------------------------
* 3. DRAW BELOW-NORMAL BAR
* ----------------------------------------------------
colors_b = {21,22,23,23,23}
say "Drawing BELOW bar"
i = 1
while (i <= 5)
  xx1 = x1 + (x2-x1)*p(i)
  xx2 = x1 + (x2-x1)*p(i+1)
  set line colors_b(i) 1
  draw rec xx1 b1y1 xx2 b1y2
  i = i + 1
endwhile
draw string x1 (b1y2+0.005) "Below Normal (%)"

* ----------------------------------------------------
* 4. DRAW NEAR-NORMAL BAR
* ----------------------------------------------------
say "Drawing NEAR bar"
i = 1
while (i <= 5)
  xx1 = x1 + (x2-x1)*p(i)
  xx2 = x1 + (x2-x1)*p(i+1)
  set line 24 1
  draw rec xx1 b2y1 xx2 b2y2
  i = i + 1
endwhile
draw string x1 (b2y2+0.005) "Near Normal (%)"

* ----------------------------------------------------
* 5. DRAW ABOVE-NORMAL BAR
* ----------------------------------------------------
colors_a = {25,26,27,27,27}
say "Drawing ABOVE bar"
i = 1
while (i <= 5)
  xx1 = x1 + (x2-x1)*p(i)
  xx2 = x1 + (x2-x1)*p(i+1)
  set line colors_a(i) 1
  draw rec xx1 b3y1 xx2 b3y2
  i = i + 1
endwhile
draw string x1 (b3y2+0.005) "Above Normal (%)"

return

