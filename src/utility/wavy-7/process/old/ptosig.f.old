      PROGRAM SMI                                                       
C*** 9/14/91 UNFORMATTED OUTPUT FOR CRAY  ..............                
C*** CERR CORRECTIONS DONE BY MJF 6/9/88                                
C*** CERRR CORRECTION DONE BY MJF 8/10/88 (RH WAS CLOBBEREDZ)           
C                                                                       
C*** ALTERED TO READ PULLANA3 OUTPUT FORMAT 8/15/90                     
C                                                                       
C$$$  MAIN PROGRAM DOCUMENTATION BLOCK                                  
C                                                                       
C MAIN PROGRAM:  SMI 40  18   PRESSURE TO SIGMA TRANSFORMATION          
C   AUTHOR: J. SELA          ORG: W/NMC32     DATE: 85/01/15            
C                                                                       
C ABSTRACT: READS COEFFICIENTS OF SURFACE TOPOGRAPHY.                   
C           READS COEFFICIENTS OF MANDATORY LEVELS ISOBARIC DATA        
C  COMPUTES VALUES OF THESE ON A GAUSSIAN GRID                          
C  COMPUTES SURFACE PRESSURE, THE HEIGHT OF THE SIGMA SURFACES          
C   AND WINDS AND HUMIDITY IN THE SIGMA LAYERS. COMPUTES LAYER          
C   TEMPERATURES AND CONVERTS RELATIVE TO SPECIFIC HUMIDITY.            
C   FORMS SIGMA LAYER VALUES IN COEFFICIENTS FORM.                      
C   FORMS DIVERGENCE AND RELATIVE VORTICITY.                            
C   PROGRAM WRITES:                                                     
C   SIGMA FILE CONTAINING COEFFICIENTS OF TERRAIN HEIGHT, LOG OF        
C   SURFACE PRESSURE,  18  LEVELS OF TEMPERATURE, 18  LEVELS OF         
C   DIVERGENCE AND VORTICITY IN PAIRS, AND  12  LEVELS OF               
C   MIXING RATIO.                                                       
C                                                                       
C USAGE:                                                                
C                                                                       
C   INPUT FILES:                                                        
C     PARM FLD   - READ FROM UNIT5 BY SUBR PRMFLD. CONTAINS             
C                  UNIT NUMBERS FOR I/O FILES IZLN, M AND NSIG.         
C     UNIT IZLN  - TERRAIN HEIGHT COEFFICIENTS (FILE IZLN)              
C     UNIT5      - CARD IMAGE FILE                                      
C     UNIT M     - ANALYSIS COEFFICIENTS IN PRESSURE LEVELS             
C                  (FILE M)                                             
C                                                                       
C   OUTPUT FILES:                                                       
C     UNIT6      - PRINT FILE                                           
C     UNIT NSIG  - COEFFICIENTS IN SIGMA LAYERS                         
C                  (FILE NSIG)                                          
C                                                                       
C   SUBPROGRAMS CALLED:                                                 
C     UNIQUE:    - PTOS,SIRCLN,SIRLNU,SETSIG,SHOWHR,PRMFLD,XMOVEX,      
C                  XSTORE,STIMER,TTIMER,ERRSET,ENCODE,DECODE,           
C                  FFS99,FFA99,FAX,FFTRIX,VPASSM,FFT99M,FFT99A,         
C                  FFT99B,PTOSIG,GETPS,LOWTMP,ERWINA,SUMPLS,            
C                  SUMPLV,SYMASY,MOVEFF,PLN2,NEGPLN,EPSLON,             
C                  GLATS,POLY,UVDZ99,PLNDER,PSUM2,MSUM2,IMINV           
C     LIBRARY:                                                          
C       W3LIB    - W3STRT,W3STOP,W3EXIT,W3FS03                          
C                                                                       
C   EXIT STATES:                                                        
C     COND =   0 - SUCCESSFUL RUN                                       
C                                                                       
C   REMARKS: SUBR PRMFLD READS 28 VALUES OF NUM. IZLN=NUM(1)=01,        
C     M=NUM(2)=10,NSIG=NUM(3)=12                                        
C     THESE NUMERICAL VALUES ARE SUBJECT TO CHANGE SINCE THEY           
C     ARE READ IN FROM UNIT5.                                           
C                                                                       
C                                                                       
C ATTRIBUTES:                                                           
C   LANGUAGE: CDC FORTRAN 66                                            
C                                                                       
C   COMPILER OPTIONS: O=BOV FOR R4012                                   
C   COMPILER OPTIONS: O=B   FOR R40 AND MORE THAN 12 LEVELS             
C                                                                       
C                                                                       
C$$$                                                                    
CX CHANGES MADE BY DMS ON 2/23/93 TO ACCOMODATE INPUT
CX FROM R40 POST-PROCESSING AND OUTPUT TO R15 ICS
CX ARE INDICATED BY 'CX'
C.......................................................                
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
CX
      DIMENSION SPECHI(2,41,41),SPCLOS(NTS),SPCLOV(NTV)
        DIMENSION RDT(4),RDATE(4),R1IBM(NTS),R2IBM(NTV)            
        DIMENSION      HFTOP(NTS)                                   
        DIMENSION HF1CYB(NTS),HF2CYB(NTV),HFSI(KMXP),HFSL(KMAX)      
CERR                                                                    
        DIMENSION HIYR(2),HMONTH(2),HIDAY(2)                         
CERR                                                                    
      DIMENSION REALT(NTS),REALA(NTS,KMXI),REALB(NTV,KMXI),
     *REALC(NTV,KMXI)
      DIMENSION REALRH(NTS,KRHI)                                       
      DIMENSION RESPQ(NTS),RESPT(NTS,KMAX),RESPRH(NTS,KMAX)           
C.E                                                                     
      DIMENSION LAB(4),IDATE(4),IDATEC(4),NUM(28)     
      DIMENSION PMAND(MAND), ALNP(MAND)                                   
      COMMON ZC(KMXI),TC(KMXI),                                         
     1 PLN( NRV ),EPS( NRV ),COLRAD(LATH),WGT(LATH),                  
     2 WGTCS(LATH),RCS2(LATH),                                          
     3 CI(KMXP),SI(KMXP),DEL(KMAX),SL(KMAX),CL(KMAX),                   
     4 RPI(KMXM),PS(LONG ),                                             
     5US(LONG ,KMAX),VS(LONG ,KMAX),                                    
     6TS(LONG ,KMAX),RS(LONG ,KMXQ),QEXTP(LONG ,KMAX),                  
     7 WORKP(LONG ,KMXI),WORKS(LONG ,KMAX),PCOF(LONG ,KMAX)             
C     A=HEIGHT B=U,C=V                                                  
      COMMON PSFC(LONG ,LATG ),RHLN( NRS,KRHI),TOP( NRS  ),              
     1 A( NRS  ,KMXI),B( NRV  ,KMXI),C( NRV  ,KMXI),                    
     2 U(LONG ,KMXI),V(LONG ,KMXI),ZSTAR(LONG ),                        
     3 T(LONG ,KMXI),Z(LONG ,KMXI),RH(LONG,KRHI),                       
     4 ZF(NWS ,KMXI),RHF(NWS ,KMXI),ZSTAF(NWS ),                        
     5 UF(NWS ,KMXI),VF(NWS ,KMXI)                                      
      COMPLEX A,B,C,RHLN,TOP,ZF,RHF,ZSTAF,UF,VF                         
      COMMON SPRH( NRS  ,KMAX),SPU( NRV  ,KMAX),SPV( NRV  ,KMAX),       
     1 SPT( NRS  ,KMAX),SPQ( NRS  )                                     
      COMPLEX SPRH,SPU,SPV,SPT,SPQ                                      
      COMMON /RELH/RHMIN,RHMAX,NSAT,NNEG,RLRV,CONST                     
C.                                                                      
      EQUIVALENCE (REALT(1),TOP(1))                                     
      EQUIVALENCE (REALA (1,1),   A(1,1))                               
      EQUIVALENCE (REALB (1,1),   B(1,1))                               
      EQUIVALENCE (REALC (1,1),   C(1,1))                               
      EQUIVALENCE (REALRH(1,1),RHLN(1,1))                               
      EQUIVALENCE (RESPQ(1),SPQ(1))                                     
      EQUIVALENCE (RESPT(1,1),SPT(1,1))                                 
      EQUIVALENCE (RESPRH(1,1),SPRH(1,1))                               
CERR                                                                    
      EQUIVALENCE(HIYR(1),IYR),(HMONTH(1),MONTH),(HIDAY(1),IDAY)        
CERR                                                                    
C                                                                       
C*************** FORM=TRUE IF INPUT IS FORMATTED *******************    
      LOGICAL FORM,NEWTIM
      DATA FORM/.FALSE./,NEWTIM/.FALSE./  
C*************** FORM=TRUE IF INPUT IS FORMATTED *******************    
C                                                                       
CX    DATA PMAND  /1000.,  850., 700., 500., 400., 300., 250.,          
CX   1                200., 150., 100.,  70.,  50.,  30.,  20.,  10./   
      DATA PMAND  /1000.,  850., 700., 500., 400., 300., 250.,          
     1                200., 150., 100.,  70.,  50./   
      JCAP=NWS-1
      LEVS=KMAX
      CALL OPNFI
      CALL W3STRT                                                       
      PRINT 98,JCAP,LEVS                                                
98    FORMAT(1H0,'GCI',I2,I2,'Y CREATED MAY  9 1984')                   
      CALL XSTORE(SPQ(1),0.,NTS )                                   
      CALL XSTORE(SPT(1,1),0.,NTS *KMAX)                            
      CALL XSTORE(SPU(1,1),0.,NTV *KMAX)                            
      CALL XSTORE(SPV(1,1),0.,NTV *KMAX)                            
      CALL XSTORE(SPRH(1,1),0.,NTS *KMAX)                           
C***     NSAT IS COUNTER FOR RH POINTS GT SATPER                        
      RHMAX=-1.E+10                                                     
      RHMIN=-RHMAX                                                      
      NNEG=0                                                            
      NSAT=0                                                            
      RLRV=2.51E+10/(1.61*2.87E+6)                                      
      CONST=6.11*EXP(RLRV/273.16)  /  10.                               
C***  FACTOR 1/10 CONVERTS TO CB.                                       
      DO 5 K=1,MAND                                                     
5     ALNP(K) = ALOG(PMAND(K))                                          
      CALL ERRSET (208, 0, -1, 1)                                       
      CALL EPSLON(EPS,JCAP)                                             
      CALL GLATS(LATH,COLRAD,WGT,WGTCS,RCS2)                            
      CALL SETSIG(CI,SI,DEL,SL,CL,RPI)                                  
      CALL PRMFLD(NUM)                                                  
      IZLN=NUM(1)                                                       
      M=NUM(2)                                                          
      NSIG=NUM(3)                                                       
      REWIND NSIG                                                       
C.TOPO                                                                  
      READ(IZLN) R1IBM                                                  
      WRITE(6,6002) R1IBM(1),R1IBM(2),R1IBM(3),R1IBM(4),
     1              R1IBM(5),R1IBM(6),R1IBM(7),R1IBM(8)
 6002 FORMAT(' TOPOG READ IN ',4(1PE12.3)/4(1PE12.3))
 9999 FORMAT (10Z8)                                                     
      REWIND IZLN                                                       
      DO 361 I=1,NTS                                                   
      HFTOP(I)=R1IBM(I)                                                 
      REALT(I)=HFTOP(I)                                                 
 361  CONTINUE                                                          
C.TIME                                                                  
C                                                                       
CX..DMS...2/23/93..SPECIAL CODE TO HANDLE POST-PROC.OUTPUT
CX    IF(.NOT.FORM)READ(M)IYR,MONTH,IDAY,HIHR                           
      IF(.NOT.FORM)READ(M)FHOURP,IHR,IDAY,MONTH,IYR  
        WRITE(6,3002) FHOURP,IHR,IDAY,MONTH,IYR
 3002   FORMAT(' FHOURP=',F10.1,' IHR,IDAY,MONTH,IYR= ',4(I4))
      IF(FORM)READ(M,9999)IYR,MONTH,IDAY,HIHR                           
      HOUR=IHR                                                         
      IDATE(1)=HOUR                                                     
      IDATE(2)=MONTH                                                    
      IDATE(3)=IDAY                                                     
CX    IF(.NOT.NEWTIM)THEN
CX    IDATE(4)=IYR-1900                                                 
CX    ELSE
      IDATE(4)=IYR
CX    END IF
      IDATEC(1)=HOUR
      IDATEC(2)=MONTH
      IDATEC(3)=IDAY
      IDATEC(4)=IYR
C     READ(M)                                                           
C     READ(M)FHOUR,IDATE                                                
CERR                                                                    
      PRINT *,IDATE                                                     
C3000 FORMAT(' READ RECORD FOR TIME ',I2,' Z,',2X,I2,'/',I2,'/',I2)     
      WRITE(6,6003)IYR,MONTH,IDAY,HIHR                                  
 6003 FORMAT(' READ ',3I5,2X,F4.1)                                      
C                                                                       
CX....SKIP SURFACE PRESSURE
      READ(M) SPECHI
CX....READ U-VELOCITY
      DO K=1,KMXI
      READ(M) SPECHI
      CALL REDVEC(SPECHI,REALB(1,K),NWS,NWV,NTV)
      END DO
CX....READ V-VELOCITY
      DO K=1,KMXI
      READ(M) SPECHI
      CALL REDVEC(SPECHI,REALC(1,K),NWS,NWV,NTV)
      END DO
CX....SKIP OMEGA
      DO K=1,KMXI
      READ(M) SPECHI
      END DO
CX....SKIP SEA LEVEL PRESSURE
      READ(M) SPECHI
CX....READ GEOPOTENTIAL HEIGHT
      DO K=1,KMXI
      READ(M) SPECHI
      CALL REDSCA(SPECHI,REALA(1,K),NWS,NTS)
      END DO
CX....SKIP TEMPERATURES
      DO K=1,KMXI
      READ(M) SPECHI
      END DO
CX....READ RELATIVE HUMIDITIES
      DO K=1,KRHI
      READ(M) SPECHI
      CALL REDSCA(SPECHI,REALRH(1,K),NWS,NTS)
      END DO
C*** READ PULLANA3 (ALBERTA) FORMAT: U,V,Z,T,RH                         
CX    DO 11 K=1,KMXI                                                   
CX    IF(.NOT.FORM)READ(M)(REALB(I,K),I=1,NTV)                         
CX 11 IF(FORM)READ(M,9999)(REALB(I,K),I=1,NTV)                         
CX    DO 12 K=1,KMXI                                                    
CX    IF(.NOT.FORM)READ(M)(REALC(I,K),I=1,NTV)                         
CX 12 IF(FORM)READ(M,9999)(REALC(I,K),I=1,NTV)                         
CX    DO 13 K=1,KMXI                                                    
CX    IF(.NOT.FORM)READ(M)(REALA(I,K),I=1,NTS)                         
CX 13 IF(FORM)READ(M,9999)(REALA(I,K),I=1,NTS)                         
CX    DO 14 K=1,KMXI                                                    
CX    IF(.NOT.FORM)READ(M)R1IBM                                         
CX 14 IF(FORM)READ(M,9999)R1IBM                                         
CX    DO 15 K=1,KRHI                                                    
CX    IF(.NOT.FORM)READ(M)(REALRH(I,K),I=1,NTS)                        
CX 15 IF(FORM)READ(M,9999)(REALRH(I,K),I=1,NTS)                        
C.                                                                      
      DO 1000 LAT=1, LATH                                               
      LATCO=LAT                                                         
      CALL PLN2(PLN,COLRAD,LAT,EPS)                                     
C----    GET FOURIER COEFF                                              
      DO 20 K=1,KMXI                                                    
      CALL SUMPLS(A(1,K),Z(1,K),ZF(1,K),PLN)                            
      CALL SUMPLV(B(1,K),U(1,K),UF(1,K),PLN)                            
      CALL SUMPLV(C(1,K),V(1,K),VF(1,K),PLN)                            
20    CONTINUE                                                          
      DO 21 K=1,KRHI                                                    
      CALL SUMPLS(RHLN(1,K),RH(1,K),RHF(1,K),PLN)                       
21    CONTINUE                                                          
      CALL SUMPLS(TOP,ZSTAR,ZSTAF,PLN)                                  
C                                                                       
300   CONTINUE                                                          
C                                                                       
      IF(LATCO.LE.LATH) GO TO 500                                       
      DO 22 K=1,KMXI                                                    
      CALL MOVEFF(Z(1,K),ZF(1,K))                                       
      CALL MOVEFF(U(1,K),UF(1,K))                                       
      CALL MOVEFF(V(1,K),VF(1,K))                                       
22    CONTINUE                                                          
      DO 23 K=1,KRHI                                                    
      CALL MOVEFF(RH(1,K),RHF(1,K))                                     
23    CONTINUE                                                          
      CALL MOVEFF(ZSTAR,ZSTAF)                                          
C                                                                       
500   CONTINUE                                                          
C                                                                       
C----    CONSTRUCT GRID DATA FROM FOURIER SERIES                        
      CALL FFS99(Z,WORKP,KMXI)                                          
      CALL FFS99(U,WORKP,KMXI)                                          
      CALL FFS99(V,WORKP,KMXI)                                          
      CALL FFS99(RH,WORKP,KRHI)                                         
      CALL FFS99(ZSTAR,WORKP,1)                                         
      DO 50 LO=1,LONG                                                   
         DO 30 K=1,KMXI                                                 
30       ZC(K)=Z(LO,K)                                                  
      CALL LOWTMP(ZC,TC)                                                
         DO 40 K=1,KMXI                                                 
40       T(LO,K)=TC(K)                                                  
50    CONTINUE                                                          
      CALL GETPS(Z,ZSTAR,ALNP,T,PSFC,LATCO)                             
      DO 51 LO=1,LONG                                                   
        PSFC(LO,LATCO) = EXP(PSFC(LO,LATCO))                            
51    CONTINUE                                                          
C                                                                       
      CALL PTOS(LATCO,PMAND,ALNP)                                       
C                                                                       
      IF(LATCO-LATH)400, 400,1000                                       
400   LATCO= LATG+1-LAT                                                 
      CALL NEGPLN(PLN)                                                  
      GO TO 300                                                         
1000  CONTINUE                                                          
C.IDATE IN PLACE OF LAB85                                               
C     WRITE(NSIG) IDATE                                                 
C801  FORMAT(4I2)                                                       
C                                                                       
C.....WRITE(NSIG) HOUR,IDATE,SI,SL                                      
      HOUR = 0.                                                         
      IFDAY=0
      TOD = 0.
      DO 366 I=1,KMXP                                                   
      HFSI(I)=SI(I)                                                     
 366  CONTINUE                                                          
      DO 3660 I=1,KMAX                                                  
      HFSL(I)=SL(I)                                                     
 3660 CONTINUE                                                          
      IF(.NOT.NEWTIM)WRITE(NSIG)HOUR,IDATE,HFSI,HFSL
      IF(NEWTIM)WRITE(NSIG)IFDAY,TOD,IDATE,IDATEC,HFSI,HFSL
CFOR  WRITE(NSIG,8020)HOUR,IDATE,HFSI,HFSL                              
 8020 FORMAT(E16.8,4I5/(5E16.8))                                        
C                                                                       
C.....WRITE(NSIG) TOP                                                   
      DO 367 I=1,NTS                                                   
      HF1CYB(I)=REALT(I)                                                
 367  CONTINUE                                                          
CFOR  WRITE(NSIG,800) HF1CYB                                            
      WRITE(NSIG) HF1CYB                                                
 800  FORMAT(5E16.8)                                                    
C                                                                       
C.....WRITE(NSIG)SPQ                                                    
      DO 368 I=1,NTS                                                   
      HF1CYB(I)=RESPQ(I)                                                
 368  CONTINUE                                                          
C     WRITE(NSIG,800) HF1CYB                                            
      WRITE(NSIG) HF1CYB                                                
C                                                                       
      DO 70 K=1,KMAX                                                    
C.....WRITE(NSIG)(SPT(I,K),I=1, NRS  )                                  
      DO 369 I=1,NTS                                                  
      HF1CYB(I)=RESPT(I,K)                                              
 369  CONTINUE                                                          
C     WRITE(NSIG,800) HF1CYB                                            
      WRITE(NSIG) HF1CYB                                                
70    CONTINUE                                                          
      DO 71 K=1,KMAX                                                    
      CALL UVDZ99(TOP,SPQ,PLN,COLRAD,C,EPS,RHLN,WGTCS,                  
     1 SPU(1,K),SPV(1,K),                                               
     2 U(1,1),U(1,2),V(1,1),V(1,2),Z(1,1),Z(1,2),T(1,1),T(1,2))         
C.....WRITE(NSIG)TOP                                                    
      DO 371 I=1,NTS                                                    
      HF1CYB(I)=REALT(I)                                                
 371  CONTINUE                                                          
C     WRITE(NSIG,800) HF1CYB                                            
      WRITE(NSIG) HF1CYB                                                
C.....WRITE(NSIG)SPQ                                                    
      DO 372 I=1,NTS                                                    
      HF1CYB(I)=RESPQ(I)                                                
 372  CONTINUE                                                          
C     WRITE(NSIG,800) HF1CYB                                            
      WRITE(NSIG) HF1CYB                                                
71    CONTINUE                                                          
      DO 72 K=1,KMAX                                                    
C.....WRITE(NSIG)(SPRH(I,K),I=1, NRS  )                                 
      DO 373 I=1,NTS                                                    
      HF1CYB(I)=RESPRH(I,K)                                             
 373  CONTINUE                                                          
C     WRITE(NSIG,800) HF1CYB                                            
      WRITE(NSIG) HF1CYB                                                
72    CONTINUE                                                          
      PRINT 102,NSAT,NNEG,RHMIN,RHMAX                                   
102   FORMAT(1H0,I9,' POINTS WITH R.H. GT 100. ',                       
     1I9,' POINTS WITH R.H. LT 0. RH MIN MAX ARE ',2(E12.5,2X))         
      PRINT 100,IDATE                                                   
100   FORMAT(1H0,'END PRESS. TO SIGMA FOR ',4(I4,1X))                   
      CALL W3STOP                                                       
      STOP                                                              
      END                                                               
CX
      SUBROUTINE REDSCA(SPECHI,SPCLOS,NWS,NTS)
      DIMENSION SPECHI(2,41,41),SPCLOS(NTS)
      INDEX=0
      DO 100 M=1,41
        IF(M .LE. NWS) THEN
        DO 90 N=1,41
          IF(N .LE. NWS) THEN
          DO 80 IC=1,2
          INDEX=INDEX+1
          SPCLOS(INDEX)=SPECHI(IC,N,M)
   80     CONTINUE
          END IF
   90   CONTINUE
        END IF
  100 CONTINUE
      RETURN
      END
CX
      SUBROUTINE REDVEC(SPECHI,SPCLOV,NWS,NWV,NTV)
      DIMENSION SPECHI(2,41,41),SPCLOV(NTV)
      INDEX=0
      DO 100 M=1,41
        IF(M .LE. NWS) THEN
        DO 90 N=1,41
          IF(N .LE. NWV) THEN
          DO 80 IC=1,2
          INDEX=INDEX+1
          SPCLOV(INDEX)=SPECHI(IC,N,M)
   80     CONTINUE
          END IF
   90   CONTINUE
        END IF
  100 CONTINUE
      RETURN
      END
      SUBROUTINE SIRCLN (FL,FLN,PLN,LAT,WGT)                            
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION PLN(NWV , NWS),WGT(LATH),                               
     1         FL(NWS ),FLN(NWS ,NWS )                                  
      COMPLEX FLN,FL                                                    
C----    ACCUMULATE CONTRIBUTION TO FLN FROM CIR VALUES AT LAT          
C          FLN ASSUMED = 0 BE4 GOING INTO LAT LOOP                      
      DO 3 LL=1,NWS                                                     
        DO 2 IND=1,NWS                                                  
          FLN(IND,LL) = FLN(IND,LL) + CMPLX(REAL(FL(LL)) * WGT(LAT) *   
     1                  PLN(IND,LL),AIMAG(FL(LL))*WGT(LAT)*PLN(IND,LL)) 
    2   CONTINUE                                                        
    3 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE SIRLNU (FL,FLN,PLN,LAT,WGT)                            
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION PLN(NWV ,NWS ),WGT(LATH),                               
     1         FL(NWS ),FLN(NWV ,NWS )                                  
      COMPLEX FLN,FL                                                    
C----    ACCUMULATE CONTRIBUTION TO FLN FROM CIR VALUES AT LAT          
C          FLN ASSUMED = 0 BE4 GOING INTO LAT LOOP                      
      DO 3 LL=1,NWS                                                     
        DO 2 IND=1,NWV                                                  
          FLN(IND,LL) = FLN(IND,LL) + CMPLX(REAL(FL(LL)) * WGT(LAT) *   
     1                  PLN(IND,LL),AIMAG(FL(LL))*WGT(LAT)*PLN(IND,LL)) 
    2   CONTINUE                                                        
    3 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE PTOS(LATCO,PMAND,ALNP)                                 
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION PMAND(MAND), ALNP(MAND)    
      COMMON ZC(KMXI),TC(KMXI),                                         
     1 PLN( NRV ),EPS( NRV ),COLRAD(LATH),WGT(LATH),                  
     2 WGTCS(LATH),RCS2(LATH),                                          
     3 CI(KMXP),SI(KMXP),DEL(KMAX),SL(KMAX),CL(KMAX),                   
     4 RPI(KMXM),PS(LONG ),                                             
     5US(LONG ,KMAX),VS(LONG ,KMAX),                                    
     6TS(LONG ,KMAX),RS(LONG ,KMXQ),QEXTP(LONG ,KMAX),                  
     7 WORKP(LONG ,KMXI),WORKS(LONG ,KMAX),PCOF(LONG ,KMAX)             
C     A=HEIGHT B=U,C=V                                                  
      COMMON PSFC(LONG ,LATG ),RHLN( NRS,KRHI),TOP( NRS  ),   
     1 A( NRS  ,KMXI),B( NRV  ,KMXI),C( NRV  ,KMXI),                    
     2 U(LONG ,KMXI),V(LONG ,KMXI),ZSTAR(LONG ),                        
     3 T(LONG ,KMXI),Z(LONG ,KMXI),RH(LONG,KRHI),                       
     4 ZF(NWS ,KMXI),RHF(NWS ,KMXI),ZSTAF(NWS ),                        
     5 UF(NWS ,KMXI),VF(NWS ,KMXI)                                      
      COMPLEX A,B,C,RHLN,TOP,ZF,RHF,ZSTAF,UF,VF                         
      COMMON SPRH( NRS  ,KMAX),SPU( NRV  ,KMAX),SPV( NRV  ,KMAX),       
     1 SPT( NRS  ,KMAX),SPQ( NRS  )                                     
      COMPLEX SPRH,SPU,SPV,SPT,SPQ                                      
      COMMON /RELH/RHMIN,RHMAX,NSAT,NNEG,RLRV,CONST                     
C     R.H.=100*EOFP/ES                                                  
C     ES=6.11*EXP(L/R(1/273.16-1/T)) SAT VAP. PRES.(MB)                 
C     Q=0.622*EOFP/(P-.378*EOFP) MIXING RATIO                           
      PIO2=3.141592653589793238/2.0                                     
      CALL PTOSIG(PSFC,LATCO,SI,ZSTAR,PMAND,ALNP,                       
     1 Z,T,U,V,US,VS,RH,RS,TS,SL)                                       
      LAT=LATCO                                                         
      IF(LATCO.GT.LATH) LAT= LATG+1-LATCO                               
      XLAT=PIO2-COLRAD(LAT)                                             
      IF(LATCO.GT.LATH) XLAT = - XLAT                                   
      CALL FFA99(US,PCOF,WORKS,KMAX)                                    
      DO 60 K=1,KMAX                                                    
      CALL SIRLNU(PCOF(1,K),SPU(1,K),PLN,LAT,WGT)                       
60    CONTINUE                                                          
      CALL FFA99(VS,PCOF,WORKS,KMAX)                                    
      DO 61 K=1,KMAX                                                    
      CALL SIRLNU(PCOF(1,K),SPV(1,K),PLN,LAT,WGT)                       
61    CONTINUE                                                          
      CALL FFA99(TS,PCOF,WORKS,KMAX)                                    
      DO 62 K=1,KMAX                                                    
      CALL SIRCLN(PCOF(1,K),SPT(1,K),PLN,LAT,WGT)                       
62    CONTINUE                                                          
      DO 63 I=1,LONG                                                    
      PS(I)=PSFC(I,LATCO)/10.                                           
63    CONTINUE                                                          
C*** PS NOW IN CB.  CONVERT R.H. TO MIXING RATIO                        
      DO 65 K=1,KMXQ                                                    
      DO 64 I=1,LONG                                                    
      IF(RS(I,K).LT.100.) GO TO 80                                      
      NSAT=NSAT+1                                                       
      IF(RS(I,K).GT.RHMAX) RHMAX=RS(I,K)                                
      RS(I,K)=100.                                                      
80    CONTINUE                                                          
      IF(RS(I,K).GE.0.) GO TO 81                                        
      NNEG=NNEG+1                                                       
      IF(RS(I,K).LT.RHMIN) RHMIN=RS(I,K)                                
      RS(I,K)=0.                                                        
81    CONTINUE                                                          
C.....CALCULATE MIXING RATIO USING TEMP. USING 5 ITERATIONS..           
      RELHUM= RS(I,K)                                                   
      TVIRT = TS(I,K)                                                   
      TEMPO = TVIRT                                                     
      DO 82 JVIRT= 1,5                                                  
        ES=CONST/EXP(RLRV/TEMPO)                                        
        EOFP=RELHUM*ES/100.                                             
        RS(I,K)=0.622*EOFP/(SL(K)*PS(I)-0.378*EOFP)                     
        TEMPO=TVIRT*(1.-0.61*RS(I,K))                                   
82    CONTINUE                                                          
C...........OLD VERSION ..................................              
C...  ES=CONST/EXP(RLRV/TS(I,K))                                        
C...  EOFP=RS(I,K)*ES/100.                                              
C...  RS(I,K)=0.622*EOFP/(SL(K)*PS(I)-0.378*EOFP)                       
C.........................................................              
64    CONTINUE                                                          
65    CONTINUE                                                          
      IF(KMXQ.LT.KMAX)CALL EXMOIS(PS,RS,TS,QEXTP,LATCO,XLAT)                            
      CALL FFA99(QEXTP,PCOF,WORKS,KMAX)                                 
      DO 66 K=1,KMAX                                                    
      CALL SIRCLN(PCOF(1,K),SPRH(1,K),PLN,LAT,WGT)                      
66    CONTINUE                                                          
      DO 67 I=1,LONG                                                    
      PS(I)=ALOG(PS(I))                                                 
67    CONTINUE                                                          
      CALL FFA99(PS,PCOF,WORKS,1)                                       
      CALL SIRCLN(PCOF(1,1),SPQ,PLN,LAT,WGT)                            
      RETURN                                                            
      END                                                               
      LOGICAL FUNCTION W3AQ09(N)                                        
      N=0                                                               
      W3AQ09=.FALSE.                                                    
      RETURN                                                            
      END                                                               
      SUBROUTINE SETSIG(CI, SI, DEL, SL, CL, RPI)                       
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION CI(KMXP), SI(KMXP),                                     
     1 DEL(KMAX), SL(KMAX), CL(KMAX), RPI(KMXM)                         
      DIMENSION DELSIG(KMAX)                                            
      SAVE DELSIG
C                                                                       
      DATA DELSIG/ .01,.017,0.025,0.055,0.073,0.085,0.093,              
     * 0.096,0.096,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05/        
C                                                                       
      PRINT 98                                                          
98    FORMAT (1H0, 'BEGIN SETSIG')                                      
      DO 9889 K=1,KMAX                                                  
9889  DEL(K)=DELSIG(K)                                                  
      CI(1) = 0. E0                                                     
      SUMDEL=0. E0                                                      
      DO 54 K=1,KMAX                                                    
      SUMDEL=SUMDEL+DEL(K)                                              
      CI(K+1)=CI(K)+DEL(K)                                              
54    CONTINUE                                                          
      CI(KMXP)=1. E0                                                    
      RK =  287.05E0  /  1005.E0                                        
      RK1 = RK + 1. E0                                                  
      LEVS= KMAX                                                        
      DO 1 LI=1,KMXP                                                    
1     SI(LI) = 1. E0 - CI(LI)                                           
      DO 3 LE=1,KMAX                                                    
C     DIF = SI(LE)**RK1 - SI(LE+1)**RK1                                 
      SIRK=RK1*ALOG(SI(LE))                                             
      SIRK=EXP(SIRK)                                                    
       IF(LE.LT.KMAX) THEN                                                
      SI1RK=RK1*ALOG(SI(LE+1))                                          
      SI1RK=EXP(SI1RK)                                                  
       ELSE                                                             
      SI1RK=0.                                                          
       END IF                                                           
      DIF = SIRK  - SI1RK                                               
      DIF = DIF / (RK1*(SI(LE)-SI(LE+1)))                               
C     SL(LE) = DIF**(1. E0/RK)                                          
      SLLE=(1. E0/RK)*ALOG(DIF)                                         
      SL(LE)= EXP(SLLE)                                                 
      CL(LE) = 1. E0 - SL(LE)                                           
3     CONTINUE                                                          
C     COMPUTE PI RATIOS FOR TEMP. MATRIX.                               
      DO 4 LE=1,KMXM                                                    
C4     RPI(LE) = (SL(LE+1)/SL(LE))**RK                                  
      RPILE=RK*ALOG(SL(LE+1)/SL(LE))                                    
4     RPI(LE)=EXP(RPILE)                                                
      DO 5 LE=1,KMXP                                                    
      PRINT 100, LE, CI(LE), SI(LE)                                     
100   FORMAT (1H , 'LEVEL=', I2, 2X, 'CI=', F6.3, 2X, 'SI=', F6.3)      
5     CONTINUE                                                          
      PRINT 97                                                          
97    FORMAT (1H0)                                                      
      DO 6 LE=1,KMAX                                                    
      PRINT 101, LE, CL(LE), SL(LE), DEL(LE)                            
101   FORMAT (1H , 'LAYER=', I2, 2X, 'CL=', F6.3, 2X, 'SL=', F6.3, 2X,  
     1 'DEL=', F6.3)                                                    
6     CONTINUE                                                          
      PRINT 102, (RPI(LE), LE=1,KMXM)                                   
102   FORMAT (1H0, 'RPI=', (18(1X,F6.3)) )                              
      PRINT 99,KMAX,SUMDEL                                                   
99    FORMAT (1H0,'SHALOM FROM MRF',I3,' LEVEL GDAS SUMDEL=',E13.4)        
      RETURN                                                            
      END                                                               
      SUBROUTINE SHOWHR(THOUR,K)                                        
      PRINT 100,THOUR                                                   
100   FORMAT(1H ,'FORECAST REACHED ',F6.2,' HOURS')                     
      RETURN                                                            
      END                                                               
      SUBROUTINE W3STRT                                                 
      PRINT 100                                                         
100   FORMAT(1H0,'FAKE OPERATIONAL W3STRT')                             
      RETURN                                                            
      END                                                               
      SUBROUTINE W3STOP                                                 
      PRINT 100                                                         
100   FORMAT(1H0,'FAKE OPERATIONAL W3STOP')                             
      RETURN                                                            
      END                                                               
      SUBROUTINE W3EXIT(R,I)                                            
      PRINT 100                                                         
100   FORMAT(1H0,'FAKE OPERATIONAL W3EXIT')                             
      RETURN                                                            
      END                                                               
      SUBROUTINE W3FS03(I,J,K,L,M)                                      
      PRINT 100                                                         
100   FORMAT(1H0,'FAKE OPERATIONAL W3FS03')                             
      RETURN                                                            
      END                                                               
      SUBROUTINE PRMFLD(NUM)                                            
      DIMENSION NUM(28)                                                 
C     DO 1 I=1,28                                                       
C1     NUM(I)=0                                                         
C     READ(5,100)NUM                                                    
C100   FORMAT(28I2)                                                     
C      PRINT 101,NUM                                                    
C101   FORMAT(1H0,'NUM=',28(1X,I2))                                     
      NUM(1) = 1                                                        
      NUM(2) = 10                                                       
      NUM(3) = 12                                                       
      RETURN                                                            
      END                                                               
      SUBROUTINE XMOVEX(A,B,N)                                          
C***   FAKE 360/195 BIT MOVING ROUTINE                                  
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      COMPLEX A( NRS  ),B( NRS  )                                       
      DO 1 I=1, NRS                                                     
1     A(I)=B(I)                                                         
      RETURN                                                            
      END                                                               
      SUBROUTINE XSTORE(A,X,N)                                          
C***   FAKE 360/195 BYTE MOVING ROUTINE                                 
      DIMENSION A(*)                                                    
      DO 1 I=1,N                                                        
1     A(I)=X                                                            
      RETURN                                                            
      END                                                               
      SUBROUTINE STIMER                                                 
C***   FAKE I.B.M. TIMER                                                
      RETURN                                                            
      END                                                               
      SUBROUTINE TTIMER(T)                                              
C***   FAKE I.B.M. TIMER                                                
      RETURN                                                            
      END                                                               
      SUBROUTINE ERRSET(I,J,K,L)                                        
C***   FAKE I.B.M. UNDERFLOW                                            
      RETURN                                                            
      END                                                               
      SUBROUTINE ENCODE(A,J)                                            
      RETURN                                                            
      END                                                               
      SUBROUTINE DECODE(A,J)                                            
      RETURN                                                            
      END                                                               
      SUBROUTINE FFS99 (A,W,LOT)                                        
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION A(LONG ), W(LONG )                                      
C                                                                       
      COMMON /FFTS/ IFAX(10), TRIGS(LONG ,2)                            
C                                                                       
C  GENERAL MULTIPLE FAST FOURIER TRANSFORM - SYNTHESIS.                 
C                                                                       
C     DIMENSION A(LONG ,LOT), W(LONG ,LOT)                              
C                                                                       
C   INPUT - LOT SETS OF COMPLEX COEFFICIENTS IN                         
C           A(1,J), A(2,J), ..., A(NWS *2,J), J=1,...,LOT.              
C           A( NWS*2+1,J), ..., A(LONG ,J), J=1,...,LOT ARE NOT SET     
C           BEFORE CALL FFS99, BUT ARE SET TO 0.0 IN FFS99.             
C                                                                       
C  OUTPUT - LOT SETS OF GRID VALUES IN                                  
C           A(1,J), A(2,J), ..., A(LONG ,J), J=1,...,LOT.               
C                                                                       
C  W IS A WORK ARRAY.                                                   
C                                                                       
C  IFAX ARRAY IS SET FOR FFT99M                                         
C              DURING FIRST USE OF FFS99 AND FFA99.                     
C  TRIGS ARRAY IS SET WITH SIN AND COS VALUES                           
C              DURING FIRST USE OF FFS99 AND FFA99.                     
      SAVE ITEST
      DATA ITEST/0/                                                     
      IF (ITEST.EQ.1)  GO TO 200                                        
            ITEST=1                                                     
            CALL    FAX ( IFAX, LONG , 3)                               
            CALL FFTRIX (TRIGS, LONG , 3)                               
200   CONTINUE                                                          
C                                                                       
      IBASE= NWS*2+1                                                    
      JBASE= LONG                                                       
      DO 400 L=1,LOT                                                    
            DO 300 I=IBASE,JBASE                                        
                  A(I)=0.0                                              
300         CONTINUE                                                    
            IBASE=IBASE+ LONG                                           
            JBASE=JBASE+ LONG                                           
400   CONTINUE                                                          
C                                                                       
C     CALL MODIFIED VERSION OF FFT99 FROM EUROPEAN CENTER.              
      CALL FFT99M (A, W, TRIGS, IFAX, 1, LONG , LONG , LOT, 1)          
C                                                                       
      RETURN                                                            
      END                                                               
      SUBROUTINE FFA99 (G,A,W,LOT)                                      
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION G(LONG ), A(LONG ), W(LONG )                            
C                                                                       
      COMMON /FFTS/ IFAX(10), TRIGS(LONG ,2)                            
C                                                                       
C  GENERAL MULTIPLE FAST FOURIER TRANSFORM - ANALYSIS.                  
C                                                                       
C     DIMENSION G(LONG ,LOT), A(LONG ,LOT), W(LONG ,LOT)                
C                                                                       
C   INPUT - LOT SETS OF GRID VALUES IN                                  
C           G(1,J), G(2,J), ..., G(LONG ,J), J=1,...,LOT.               
C           G ARRAY IS NOT CHANGED BY SUBROUTINE FFA99.                 
C                                                                       
C  OUTPUT - LOT SETS OF COMPLEX COEFFICIENTS IN                         
C           A(1,J), A(2,J), ..., A(LONG ,J), J=1,...,LOT.               
C           COMPLEX COEFFICIENTS IN                                     
C           A(NWS *2+1,J), ..., A(LONG ,J), J=1,...,LOT ARE NOT USED    
C           OUTSIDE FFA99.                                              
C                                                                       
C  W IS A WORK ARRAY.                                                   
C                                                                       
C  IFAX ARRAY IS SET FOR FFT99M                                         
C              DURING FIRST USE OF FFS99 AND FFA99.                     
C  TRIGS ARRAY IS SET WITH SIN AND COS VALUES                           
C              DURING FIRST USE OF FFS99 AND FFA99.                     
      SAVE ITEST
      DATA ITEST/0/                                                     
      IF (ITEST.EQ.1)  GO TO 200                                        
            ITEST=1                                                     
            CALL    FAX ( IFAX, LONG , 3)                               
            CALL FFTRIX (TRIGS, LONG , 3)                               
200   CONTINUE                                                          
C                                                                       
C     COPY G ARRAY TO A ARRAY.                                          
      IMAX= LONG*LOT                                                    
      DO 400 I=1,IMAX                                                   
            A(I)=G(I)                                                   
400   CONTINUE                                                          
C                                                                       
C     CALL MODIFIED VERSION OF FFT99 FROM EUROPEAN CENTER.              
      CALL FFT99M (A, W, TRIGS, IFAX, 1, LONG , LONG , LOT, -1)         
C                                                                       
      RETURN                                                            
      END                                                               
      SUBROUTINE FAX(IFAX,N,MODE)                                       
      DIMENSION IFAX(10)                                                
      NN=N                                                              
      IF (IABS(MODE).EQ.1) GO TO 10                                     
      IF (IABS(MODE).EQ.8) GO TO 10                                     
      NN=N/2                                                            
      IF ((NN+NN).EQ.N) GO TO 10                                        
      IFAX(1)=-99                                                       
      RETURN                                                            
   10 K=1                                                               
C     TEST FOR FACTORS OF 4                                             
   20 IF (MOD(NN,4).NE.0) GO TO 30                                      
      K=K+1                                                             
      IFAX(K)=4                                                         
      NN=NN/4                                                           
      IF (NN.EQ.1) GO TO 80                                             
      GO TO 20                                                          
C     TEST FOR EXTRA FACTOR OF 2                                        
   30 IF (MOD(NN,2).NE.0) GO TO 40                                      
      K=K+1                                                             
      IFAX(K)=2                                                         
      NN=NN/2                                                           
      IF (NN.EQ.1) GO TO 80                                             
C     TEST FOR FACTORS OF 3                                             
   40 IF (MOD(NN,3).NE.0) GO TO 50                                      
      K=K+1                                                             
      IFAX(K)=3                                                         
      NN=NN/3                                                           
      IF (NN.EQ.1) GO TO 80                                             
      GO TO 40                                                          
C     NOW FIND REMAINING FACTORS                                        
   50 L=5                                                               
      INC=2                                                             
C     INC ALTERNATELY TAKES ON VALUES 2 AND 4                           
   60 IF (MOD(NN,L).NE.0) GO TO 70                                      
      K=K+1                                                             
      IFAX(K)=L                                                         
      NN=NN/L                                                           
      IF (NN.EQ.1) GO TO 80                                             
      GO TO 60                                                          
   70 L=L+INC                                                           
      INC=6-INC                                                         
      GO TO 60                                                          
   80 IFAX(1)=K-1                                                       
C     IFAX(1) CONTAINS NUMBER OF FACTORS                                
C     IFAX(1) CONTAINS NUMBER OF FACTORS                                
      NFAX=IFAX(1)                                                      
C     SORT FACTORS INTO ASCENDING ORDER                                 
      IF (NFAX.EQ.1) GO TO 110                                          
      DO 100 II=2,NFAX                                                  
      ISTOP=NFAX+2-II                                                   
      DO 90 I=2,ISTOP                                                   
      IF (IFAX(I+1).GE.IFAX(I)) GO TO 90                                
      ITEM=IFAX(I)                                                      
      IFAX(I)=IFAX(I+1)                                                 
      IFAX(I+1)=ITEM                                                    
   90 CONTINUE                                                          
  100 CONTINUE                                                          
  110 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE FFTRIX(TRIGS,N,MODE)                                   
      DIMENSION TRIGS(*)                                                
      PI=2.0*ASIN(1.0)                                                  
      IMODE=IABS(MODE)                                                  
      NN=N                                                              
      IF (IMODE.GT.1.AND.IMODE.LT.6) NN=N/2                             
      DEL=(PI+PI)/FLOAT(NN)                                             
      L=NN+NN                                                           
      DO 10 I=1,L,2                                                     
      ANGLE=0.5*FLOAT(I-1)*DEL                                          
      TRIGS(I)=COS(ANGLE)                                               
      TRIGS(I+1)=SIN(ANGLE)                                             
   10 CONTINUE                                                          
      IF (IMODE.EQ.1) RETURN                                            
      IF (IMODE.EQ.8) RETURN                                            
      DEL=0.5*DEL                                                       
      NH=(NN+1)/2                                                       
      L=NH+NH                                                           
      LA=NN+NN                                                          
      DO 20 I=1,L,2                                                     
      ANGLE=0.5*FLOAT(I-1)*DEL                                          
      TRIGS(LA+I)=COS(ANGLE)                                            
      TRIGS(LA+I+1)=SIN(ANGLE)                                          
   20 CONTINUE                                                          
      IF (IMODE.LE.3) RETURN                                            
      DEL=0.5*DEL                                                       
      LA=LA+NN                                                          
      IF (MODE.EQ.5) GO TO 40                                           
      DO 30 I=2,NN                                                      
      ANGLE=FLOAT(I-1)*DEL                                              
      TRIGS(LA+I)=2.0*SIN(ANGLE)                                        
   30 CONTINUE                                                          
      RETURN                                                            
   40 CONTINUE                                                          
      DEL=0.5*DEL                                                       
      DO 50 I=2,N                                                       
      ANGLE=FLOAT(I-1)*DEL                                              
      TRIGS(LA+I)=SIN(ANGLE)                                            
   50 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE VPASSM(A,B,C,D,TRIGS,INC1,INC2,INC3,INC4,LOT,N,IFAC,LA)
      DIMENSION A(N),B(N),C(N),D(N),TRIGS(N)                            
      SAVE SIN36,COS36,SIN72,COS72,SIN60
      DATA SIN36/0.587785252292473/,COS36/0.809016994374947/,           
     *     SIN72/0.951056516295154/,COS72/0.309016994374947/,           
     *     SIN60/0.866025403784437/                                     
C                                                                       
      M=N/IFAC                                                          
      IINK=M*INC1                                                       
      JINK=LA*INC2                                                      
      JUMP=(IFAC-1)*JINK                                                
      IBASE=0                                                           
      JBASE=0                                                           
      IGO=IFAC-1                                                        
      IF (IGO.GT.4) RETURN                                              
      GO TO (10,50,90,130),IGO                                          
C                                                                       
C     CODING FOR FACTOR 2                                               
C                                                                       
   10 IA=1                                                              
      JA=1                                                              
      IB=IA+IINK                                                        
      JB=JA+JINK                                                        
      DO 20 L=1,LA                                                      
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 15 IJK=1,LOT                                                   
      C(JA+J)=A(IA+I)+A(IB+I)                                           
      D(JA+J)=B(IA+I)+B(IB+I)                                           
      C(JB+J)=A(IA+I)-A(IB+I)                                           
      D(JB+J)=B(IA+I)-B(IB+I)                                           
      I=I+INC3                                                          
      J=J+INC4                                                          
   15 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
   20 CONTINUE                                                          
      IF (LA.EQ.M) RETURN                                               
      LA1=LA+1                                                          
      JBASE=JBASE+JUMP                                                  
      DO 40 K=LA1,M,LA                                                  
      KB=K+K-2                                                          
      C1=TRIGS(KB+1)                                                    
      S1=TRIGS(KB+2)                                                    
      DO 30 L=1,LA                                                      
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 25 IJK=1,LOT                                                   
      C(JA+J)=A(IA+I)+A(IB+I)                                           
      D(JA+J)=B(IA+I)+B(IB+I)                                           
      C(JB+J)=C1*(A(IA+I)-A(IB+I))-S1*(B(IA+I)-B(IB+I))                 
      D(JB+J)=S1*(A(IA+I)-A(IB+I))+C1*(B(IA+I)-B(IB+I))                 
      I=I+INC3                                                          
      J=J+INC4                                                          
   25 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
   30 CONTINUE                                                          
      JBASE=JBASE+JUMP                                                  
   40 CONTINUE                                                          
      RETURN                                                            
C                                                                       
C     CODING FOR FACTOR 3                                               
C                                                                       
   50 IA=1                                                              
      JA=1                                                              
      IB=IA+IINK                                                        
      JB=JA+JINK                                                        
      IC=IB+IINK                                                        
      JC=JB+JINK                                                        
      DO 60 L=1,LA                                                      
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 55 IJK=1,LOT                                                   
      C(JA+J)=A(IA+I)+(A(IB+I)+A(IC+I))                                 
      D(JA+J)=B(IA+I)+(B(IB+I)+B(IC+I))                                 
      C(JB+J)=(A(IA+I)-0.5*(A(IB+I)+A(IC+I)))-(SIN60*(B(IB+I)-B(IC+I))) 
      C(JC+J)=(A(IA+I)-0.5*(A(IB+I)+A(IC+I)))+(SIN60*(B(IB+I)-B(IC+I))) 
      D(JB+J)=(B(IA+I)-0.5*(B(IB+I)+B(IC+I)))+(SIN60*(A(IB+I)-A(IC+I))) 
      D(JC+J)=(B(IA+I)-0.5*(B(IB+I)+B(IC+I)))-(SIN60*(A(IB+I)-A(IC+I))) 
      I=I+INC3                                                          
      J=J+INC4                                                          
   55 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
   60 CONTINUE                                                          
      IF (LA.EQ.M) RETURN                                               
      LA1=LA+1                                                          
      JBASE=JBASE+JUMP                                                  
      DO 80 K=LA1,M,LA                                                  
      KB=K+K-2                                                          
      KC=KB+KB                                                          
      C1=TRIGS(KB+1)                                                    
      S1=TRIGS(KB+2)                                                    
      C2=TRIGS(KC+1)                                                    
      S2=TRIGS(KC+2)                                                    
      DO 70 L=1,LA                                                      
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 65 IJK=1,LOT                                                   
      C(JA+J)=A(IA+I)+(A(IB+I)+A(IC+I))                                 
      D(JA+J)=B(IA+I)+(B(IB+I)+B(IC+I))                                 
      C(JB+J)=                                                          
     *    C1*((A(IA+I)-0.5*(A(IB+I)+A(IC+I)))-(SIN60*(B(IB+I)-B(IC+I))))
     *   -S1*((B(IA+I)-0.5*(B(IB+I)+B(IC+I)))+(SIN60*(A(IB+I)-A(IC+I))))
      D(JB+J)=                                                          
     *    S1*((A(IA+I)-0.5*(A(IB+I)+A(IC+I)))-(SIN60*(B(IB+I)-B(IC+I))))
     *   +C1*((B(IA+I)-0.5*(B(IB+I)+B(IC+I)))+(SIN60*(A(IB+I)-A(IC+I))))
      C(JC+J)=                                                          
     *    C2*((A(IA+I)-0.5*(A(IB+I)+A(IC+I)))+(SIN60*(B(IB+I)-B(IC+I))))
     *   -S2*((B(IA+I)-0.5*(B(IB+I)+B(IC+I)))-(SIN60*(A(IB+I)-A(IC+I))))
      D(JC+J)=                                                          
     *    S2*((A(IA+I)-0.5*(A(IB+I)+A(IC+I)))+(SIN60*(B(IB+I)-B(IC+I))))
     *   +C2*((B(IA+I)-0.5*(B(IB+I)+B(IC+I)))-(SIN60*(A(IB+I)-A(IC+I))))
      I=I+INC3                                                          
      J=J+INC4                                                          
   65 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
   70 CONTINUE                                                          
      JBASE=JBASE+JUMP                                                  
   80 CONTINUE                                                          
      RETURN                                                            
C                                                                       
C     CODING FOR FACTOR 4                                               
C                                                                       
   90 IA=1                                                              
      JA=1                                                              
      IB=IA+IINK                                                        
      JB=JA+JINK                                                        
      IC=IB+IINK                                                        
      JC=JB+JINK                                                        
      ID=IC+IINK                                                        
      JD=JC+JINK                                                        
      DO 100 L=1,LA                                                     
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 95 IJK=1,LOT                                                   
      C(JA+J)=(A(IA+I)+A(IC+I))+(A(IB+I)+A(ID+I))                       
      C(JC+J)=(A(IA+I)+A(IC+I))-(A(IB+I)+A(ID+I))                       
      D(JA+J)=(B(IA+I)+B(IC+I))+(B(IB+I)+B(ID+I))                       
      D(JC+J)=(B(IA+I)+B(IC+I))-(B(IB+I)+B(ID+I))                       
      C(JB+J)=(A(IA+I)-A(IC+I))-(B(IB+I)-B(ID+I))                       
      C(JD+J)=(A(IA+I)-A(IC+I))+(B(IB+I)-B(ID+I))                       
      D(JB+J)=(B(IA+I)-B(IC+I))+(A(IB+I)-A(ID+I))                       
      D(JD+J)=(B(IA+I)-B(IC+I))-(A(IB+I)-A(ID+I))                       
      I=I+INC3                                                          
      J=J+INC4                                                          
   95 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
  100 CONTINUE                                                          
      IF (LA.EQ.M) RETURN                                               
      LA1=LA+1                                                          
      JBASE=JBASE+JUMP                                                  
      DO 120 K=LA1,M,LA                                                 
      KB=K+K-2                                                          
      KC=KB+KB                                                          
      KD=KC+KB                                                          
      C1=TRIGS(KB+1)                                                    
      S1=TRIGS(KB+2)                                                    
      C2=TRIGS(KC+1)                                                    
      S2=TRIGS(KC+2)                                                    
      C3=TRIGS(KD+1)                                                    
      S3=TRIGS(KD+2)                                                    
      DO 110 L=1,LA                                                     
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 105 IJK=1,LOT                                                  
      C(JA+J)=(A(IA+I)+A(IC+I))+(A(IB+I)+A(ID+I))                       
      D(JA+J)=(B(IA+I)+B(IC+I))+(B(IB+I)+B(ID+I))                       
      C(JC+J)=                                                          
     *    C2*((A(IA+I)+A(IC+I))-(A(IB+I)+A(ID+I)))                      
     *   -S2*((B(IA+I)+B(IC+I))-(B(IB+I)+B(ID+I)))                      
      D(JC+J)=                                                          
     *    S2*((A(IA+I)+A(IC+I))-(A(IB+I)+A(ID+I)))                      
     *   +C2*((B(IA+I)+B(IC+I))-(B(IB+I)+B(ID+I)))                      
      C(JB+J)=                                                          
     *    C1*((A(IA+I)-A(IC+I))-(B(IB+I)-B(ID+I)))                      
     *   -S1*((B(IA+I)-B(IC+I))+(A(IB+I)-A(ID+I)))                      
      D(JB+J)=                                                          
     *    S1*((A(IA+I)-A(IC+I))-(B(IB+I)-B(ID+I)))                      
     *   +C1*((B(IA+I)-B(IC+I))+(A(IB+I)-A(ID+I)))                      
      C(JD+J)=                                                          
     *    C3*((A(IA+I)-A(IC+I))+(B(IB+I)-B(ID+I)))                      
     *   -S3*((B(IA+I)-B(IC+I))-(A(IB+I)-A(ID+I)))                      
      D(JD+J)=                                                          
     *    S3*((A(IA+I)-A(IC+I))+(B(IB+I)-B(ID+I)))                      
     *   +C3*((B(IA+I)-B(IC+I))-(A(IB+I)-A(ID+I)))                      
      I=I+INC3                                                          
      J=J+INC4                                                          
  105 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
  110 CONTINUE                                                          
      JBASE=JBASE+JUMP                                                  
  120 CONTINUE                                                          
      RETURN                                                            
C                                                                       
C     CODING FOR FACTOR 5                                               
C                                                                       
  130 IA=1                                                              
      JA=1                                                              
      IB=IA+IINK                                                        
      JB=JA+JINK                                                        
      IC=IB+IINK                                                        
      JC=JB+JINK                                                        
      ID=IC+IINK                                                        
      JD=JC+JINK                                                        
      IE=ID+IINK                                                        
      JE=JD+JINK                                                        
      DO 140 L=1,LA                                                     
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 135 IJK=1,LOT                                                  
      C(JA+J)=A(IA+I)+(A(IB+I)+A(IE+I))+(A(IC+I)+A(ID+I))               
      D(JA+J)=B(IA+I)+(B(IB+I)+B(IE+I))+(B(IC+I)+B(ID+I))               
      C(JB+J)=(A(IA+I)+COS72*(A(IB+I)+A(IE+I))-COS36*(A(IC+I)+A(ID+I))) 
     *  -(SIN72*(B(IB+I)-B(IE+I))+SIN36*(B(IC+I)-B(ID+I)))              
      C(JE+J)=(A(IA+I)+COS72*(A(IB+I)+A(IE+I))-COS36*(A(IC+I)+A(ID+I))) 
     *  +(SIN72*(B(IB+I)-B(IE+I))+SIN36*(B(IC+I)-B(ID+I)))              
      D(JB+J)=(B(IA+I)+COS72*(B(IB+I)+B(IE+I))-COS36*(B(IC+I)+B(ID+I))) 
     *  +(SIN72*(A(IB+I)-A(IE+I))+SIN36*(A(IC+I)-A(ID+I)))              
      D(JE+J)=(B(IA+I)+COS72*(B(IB+I)+B(IE+I))-COS36*(B(IC+I)+B(ID+I))) 
     *  -(SIN72*(A(IB+I)-A(IE+I))+SIN36*(A(IC+I)-A(ID+I)))              
      C(JC+J)=(A(IA+I)-COS36*(A(IB+I)+A(IE+I))+COS72*(A(IC+I)+A(ID+I))) 
     *  -(SIN36*(B(IB+I)-B(IE+I))-SIN72*(B(IC+I)-B(ID+I)))              
      C(JD+J)=(A(IA+I)-COS36*(A(IB+I)+A(IE+I))+COS72*(A(IC+I)+A(ID+I))) 
     *  +(SIN36*(B(IB+I)-B(IE+I))-SIN72*(B(IC+I)-B(ID+I)))              
      D(JC+J)=(B(IA+I)-COS36*(B(IB+I)+B(IE+I))+COS72*(B(IC+I)+B(ID+I))) 
     *  +(SIN36*(A(IB+I)-A(IE+I))-SIN72*(A(IC+I)-A(ID+I)))              
      D(JD+J)=(B(IA+I)-COS36*(B(IB+I)+B(IE+I))+COS72*(B(IC+I)+B(ID+I))) 
     *  -(SIN36*(A(IB+I)-A(IE+I))-SIN72*(A(IC+I)-A(ID+I)))              
      I=I+INC3                                                          
      J=J+INC4                                                          
  135 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
  140 CONTINUE                                                          
      IF (LA.EQ.M) RETURN                                               
      LA1=LA+1                                                          
      JBASE=JBASE+JUMP                                                  
      DO 160 K=LA1,M,LA                                                 
      KB=K+K-2                                                          
      KC=KB+KB                                                          
      KD=KC+KB                                                          
      KE=KD+KB                                                          
      C1=TRIGS(KB+1)                                                    
      S1=TRIGS(KB+2)                                                    
      C2=TRIGS(KC+1)                                                    
      S2=TRIGS(KC+2)                                                    
      C3=TRIGS(KD+1)                                                    
      S3=TRIGS(KD+2)                                                    
      C4=TRIGS(KE+1)                                                    
      S4=TRIGS(KE+2)                                                    
      DO 150 L=1,LA                                                     
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 145 IJK=1,LOT                                                  
      C(JA+J)=A(IA+I)+(A(IB+I)+A(IE+I))+(A(IC+I)+A(ID+I))               
      D(JA+J)=B(IA+I)+(B(IB+I)+B(IE+I))+(B(IC+I)+B(ID+I))               
      C(JB+J)=                                                          
     *    C1*((A(IA+I)+COS72*(A(IB+I)+A(IE+I))-COS36*(A(IC+I)+A(ID+I))) 
     *      -(SIN72*(B(IB+I)-B(IE+I))+SIN36*(B(IC+I)-B(ID+I))))         
     *   -S1*((B(IA+I)+COS72*(B(IB+I)+B(IE+I))-COS36*(B(IC+I)+B(ID+I))) 
     *      +(SIN72*(A(IB+I)-A(IE+I))+SIN36*(A(IC+I)-A(ID+I))))         
      D(JB+J)=                                                          
     *    S1*((A(IA+I)+COS72*(A(IB+I)+A(IE+I))-COS36*(A(IC+I)+A(ID+I))) 
     *      -(SIN72*(B(IB+I)-B(IE+I))+SIN36*(B(IC+I)-B(ID+I))))         
     *   +C1*((B(IA+I)+COS72*(B(IB+I)+B(IE+I))-COS36*(B(IC+I)+B(ID+I))) 
     *      +(SIN72*(A(IB+I)-A(IE+I))+SIN36*(A(IC+I)-A(ID+I))))         
      C(JE+J)=                                                          
     *    C4*((A(IA+I)+COS72*(A(IB+I)+A(IE+I))-COS36*(A(IC+I)+A(ID+I))) 
     *      +(SIN72*(B(IB+I)-B(IE+I))+SIN36*(B(IC+I)-B(ID+I))))         
     *   -S4*((B(IA+I)+COS72*(B(IB+I)+B(IE+I))-COS36*(B(IC+I)+B(ID+I))) 
     *      -(SIN72*(A(IB+I)-A(IE+I))+SIN36*(A(IC+I)-A(ID+I))))         
      D(JE+J)=                                                          
     *    S4*((A(IA+I)+COS72*(A(IB+I)+A(IE+I))-COS36*(A(IC+I)+A(ID+I))) 
     *      +(SIN72*(B(IB+I)-B(IE+I))+SIN36*(B(IC+I)-B(ID+I))))         
     *   +C4*((B(IA+I)+COS72*(B(IB+I)+B(IE+I))-COS36*(B(IC+I)+B(ID+I))) 
     *      -(SIN72*(A(IB+I)-A(IE+I))+SIN36*(A(IC+I)-A(ID+I))))         
      C(JC+J)=                                                          
     *    C2*((A(IA+I)-COS36*(A(IB+I)+A(IE+I))+COS72*(A(IC+I)+A(ID+I))) 
     *      -(SIN36*(B(IB+I)-B(IE+I))-SIN72*(B(IC+I)-B(ID+I))))         
     *   -S2*((B(IA+I)-COS36*(B(IB+I)+B(IE+I))+COS72*(B(IC+I)+B(ID+I))) 
     *      +(SIN36*(A(IB+I)-A(IE+I))-SIN72*(A(IC+I)-A(ID+I))))         
      D(JC+J)=                                                          
     *    S2*((A(IA+I)-COS36*(A(IB+I)+A(IE+I))+COS72*(A(IC+I)+A(ID+I))) 
     *      -(SIN36*(B(IB+I)-B(IE+I))-SIN72*(B(IC+I)-B(ID+I))))         
     *   +C2*((B(IA+I)-COS36*(B(IB+I)+B(IE+I))+COS72*(B(IC+I)+B(ID+I))) 
     *      +(SIN36*(A(IB+I)-A(IE+I))-SIN72*(A(IC+I)-A(ID+I))))         
      C(JD+J)=                                                          
     *    C3*((A(IA+I)-COS36*(A(IB+I)+A(IE+I))+COS72*(A(IC+I)+A(ID+I))) 
     *      +(SIN36*(B(IB+I)-B(IE+I))-SIN72*(B(IC+I)-B(ID+I))))         
     *   -S3*((B(IA+I)-COS36*(B(IB+I)+B(IE+I))+COS72*(B(IC+I)+B(ID+I))) 
     *      -(SIN36*(A(IB+I)-A(IE+I))-SIN72*(A(IC+I)-A(ID+I))))         
      D(JD+J)=                                                          
     *    S3*((A(IA+I)-COS36*(A(IB+I)+A(IE+I))+COS72*(A(IC+I)+A(ID+I))) 
     *      +(SIN36*(B(IB+I)-B(IE+I))-SIN72*(B(IC+I)-B(ID+I))))         
     *   +C3*((B(IA+I)-COS36*(B(IB+I)+B(IE+I))+COS72*(B(IC+I)+B(ID+I))) 
     *      -(SIN36*(A(IB+I)-A(IE+I))-SIN72*(A(IC+I)-A(ID+I))))         
      I=I+INC3                                                          
      J=J+INC4                                                          
  145 CONTINUE                                                          
      IBASE=IBASE+INC1                                                  
      JBASE=JBASE+INC2                                                  
  150 CONTINUE                                                          
      JBASE=JBASE+JUMP                                                  
  160 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE FFT99M(A,WORK,TRIGS,IFAX,INC,JUMP,N,LOT,ISIGN)         
      DIMENSION A(N),WORK(N),TRIGS(N),IFAX(1)                           
C                                                                       
      NFAX=IFAX(1)                                                      
      NX=N                                                              
      NH=N/2                                                            
      INK=INC+INC                                                       
      IF (ISIGN.EQ.+1) GO TO 30                                         
C                                                                       
C     IF NECESSARY, TRANSFER DATA TO WORK AREA                          
      IGO=50                                                            
      IF (MOD(NFAX,2).EQ.1) GOTO 40                                     
      IBASE=1                                                           
      JBASE=1                                                           
      DO 20 L=1,LOT                                                     
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 10 M=1,N                                                       
      WORK(J)=A(I)                                                      
      I=I+INC                                                           
      J=J+1                                                             
   10 CONTINUE                                                          
      IBASE=IBASE+JUMP                                                  
      JBASE=JBASE+NX                                                    
   20 CONTINUE                                                          
C                                                                       
      IGO=60                                                            
      GO TO 40                                                          
C                                                                       
C     PREPROCESSING (ISIGN=+1)                                          
C     ------------------------                                          
C                                                                       
   30 CONTINUE                                                          
      CALL FFT99A(A,WORK,TRIGS,INC,JUMP,N,LOT)                          
      IGO=60                                                            
C                                                                       
C     COMPLEX TRANSFORM                                                 
C     -----------------                                                 
C                                                                       
   40 CONTINUE                                                          
      IA=1                                                              
      LA=1                                                              
      DO 80 K=1,NFAX                                                    
      IF (IGO.EQ.60) GO TO 60                                           
   50 CONTINUE                                                          
      CALL VPASSM(A(IA),A(IA+INC),WORK(1),WORK(2),TRIGS,                
     *   INK,2,JUMP,NX,LOT,NH,IFAX(K+1),LA)                             
      IGO=60                                                            
      GO TO 70                                                          
   60 CONTINUE                                                          
      CALL VPASSM(WORK(1),WORK(2),A(IA),A(IA+INC),TRIGS,                
     *    2,INK,NX,JUMP,LOT,NH,IFAX(K+1),LA)                            
      IGO=50                                                            
   70 CONTINUE                                                          
      LA=LA*IFAX(K+1)                                                   
   80 CONTINUE                                                          
C                                                                       
      IF (ISIGN.EQ.-1) GO TO 130                                        
C                                                                       
C     IF NECESSARY, TRANSFER DATA FROM WORK AREA                        
      IF (MOD(NFAX,2).EQ.1) GO TO 110                                   
      IBASE=1                                                           
      JBASE=1                                                           
      DO 100 L=1,LOT                                                    
      I=IBASE                                                           
      J=JBASE                                                           
CDIR$ IVDEP                                                             
      DO 90 M=1,N                                                       
      A(J)=WORK(I)                                                      
      I=I+1                                                             
      J=J+INC                                                           
   90 CONTINUE                                                          
      IBASE=IBASE+NX                                                    
      JBASE=JBASE+JUMP                                                  
  100 CONTINUE                                                          
C                                                                       
C     FILL IN ZEROS AT END                                              
  110 CONTINUE                                                          
      GO TO 140                                                         
C                                                                       
C     POSTPROCESSING (ISIGN=-1):                                        
C     --------------------------                                        
C                                                                       
  130 CONTINUE                                                          
      CALL FFT99B(WORK,A,TRIGS,INC,JUMP,N,LOT)                          
C                                                                       
  140 CONTINUE                                                          
      RETURN                                                            
      END                                                               
C     SUBROUTINE FFT99A - PREPROCESSING STEP FOR FFT99, ISIGN=+1        
C     (SPECTRAL TO GRIDPOINT TRANSFORM)                                 
C                                                                       
      SUBROUTINE FFT99A(A,WORK,TRIGS,INC,JUMP,N,LOT)                    
      DIMENSION A(N),WORK(N),TRIGS(N)                                   
      NH=N/2                                                            
      NX=N                                                              
      INK=INC+INC                                                       
C                                                                       
C     A(0)   A(N/2)                                                     
      IA=1                                                              
      IB=N*INC+1                                                        
      JA=1                                                              
      JB=2                                                              
CDIR$ IVDEP                                                             
      DO 10 L=1,LOT                                                     
      WORK(JA)=A(IA)                                                    
      WORK(JB)=A(IA)                                                    
      IA=IA+JUMP                                                        
      IB=IB+JUMP                                                        
      JA=JA+NX                                                          
      JB=JB+NX                                                          
   10 CONTINUE                                                          
C                                                                       
C     REMAINING WAVENUMBERS                                             
      IABASE=2*INC+1                                                    
      IBBASE=(N-2)*INC+1                                                
      JABASE=3                                                          
      JBBASE=N-1                                                        
C                                                                       
      DO 30 K=3,NH,2                                                    
      IA=IABASE                                                         
      IB=IBBASE                                                         
      JA=JABASE                                                         
      JB=JBBASE                                                         
      C=TRIGS(N+K)                                                      
      S=TRIGS(N+K+1)                                                    
CDIR$ IVDEP                                                             
      DO 20 L=1,LOT                                                     
      WORK(JA)=(A(IA)+A(IB))-                                           
     *    (S*(A(IA)-A(IB))+C*(A(IA+INC)+A(IB+INC)))                     
      WORK(JB)=(A(IA)+A(IB))+                                           
     *    (S*(A(IA)-A(IB))+C*(A(IA+INC)+A(IB+INC)))                     
      WORK(JA+1)=(C*(A(IA)-A(IB))-S*(A(IA+INC)+A(IB+INC)))+             
     *    (A(IA+INC)-A(IB+INC))                                         
      WORK(JB+1)=(C*(A(IA)-A(IB))-S*(A(IA+INC)+A(IB+INC)))-             
     *    (A(IA+INC)-A(IB+INC))                                         
      IA=IA+JUMP                                                        
      IB=IB+JUMP                                                        
      JA=JA+NX                                                          
      JB=JB+NX                                                          
   20 CONTINUE                                                          
      IABASE=IABASE+INK                                                 
      IBBASE=IBBASE-INK                                                 
      JABASE=JABASE+2                                                   
      JBBASE=JBBASE-2                                                   
   30 CONTINUE                                                          
C                                                                       
      IF (IABASE.NE.IBBASE) GO TO 50                                    
C     WAVENUMBER N/4 (IF IT EXISTS)                                     
      IA=IABASE                                                         
      JA=JABASE                                                         
CDIR$ IVDEP                                                             
      DO 40 L=1,LOT                                                     
      WORK(JA)=2.0*A(IA)                                                
      WORK(JA+1)=-2.0*A(IA+INC)                                         
      IA=IA+JUMP                                                        
      JA=JA+NX                                                          
   40 CONTINUE                                                          
C                                                                       
   50 CONTINUE                                                          
      RETURN                                                            
      END                                                               
C     SUBROUTINE FFT99B - POSTPROCESSING STEP FOR FFT99, ISIGN=-1       
C     (GRIDPOINT TO SPECTRAL TRANSFORM)                                 
C                                                                       
      SUBROUTINE FFT99B(WORK,A,TRIGS,INC,JUMP,N,LOT)                    
      DIMENSION WORK(N),A(N),TRIGS(N)                                   
C                                                                       
      NH=N/2                                                            
      NX=N                                                              
      INK=INC+INC                                                       
C                                                                       
C     A(0)   A(N/2)                                                     
      SCALE=1.0/FLOAT(N)                                                
      IA=1                                                              
      IB=2                                                              
      JA=1                                                              
      JB=N*INC+1                                                        
CDIR$ IVDEP                                                             
      DO 10 L=1,LOT                                                     
      A(JA)=SCALE*(WORK(IA)+WORK(IB))                                   
      A(JA+INC)=0.0                                                     
      IA=IA+NX                                                          
      IB=IB+NX                                                          
      JA=JA+JUMP                                                        
      JB=JB+JUMP                                                        
   10 CONTINUE                                                          
C                                                                       
C     REMAINING WAVENUMBERS                                             
      SCALE=0.5*SCALE                                                   
      IABASE=3                                                          
      IBBASE=N-1                                                        
      JABASE=2*INC+1                                                    
      JBBASE=(N-2)*INC+1                                                
C                                                                       
      DO 30 K=3,NH,2                                                    
      IA=IABASE                                                         
      IB=IBBASE                                                         
      JA=JABASE                                                         
      JB=JBBASE                                                         
      C=TRIGS(N+K)                                                      
      S=TRIGS(N+K+1)                                                    
CDIR$ IVDEP                                                             
      DO 20 L=1,LOT                                                     
      A(JA)=SCALE*((WORK(IA)+WORK(IB))                                  
     *   +(C*(WORK(IA+1)+WORK(IB+1))+S*(WORK(IA)-WORK(IB))))            
      A(JB)=SCALE*((WORK(IA)+WORK(IB))                                  
     *   -(C*(WORK(IA+1)+WORK(IB+1))+S*(WORK(IA)-WORK(IB))))            
      A(JA+INC)=SCALE*((C*(WORK(IA)-WORK(IB))-S*(WORK(IA+1)+WORK(IB+1)))
     *    +(WORK(IB+1)-WORK(IA+1)))                                     
      A(JB+INC)=SCALE*((C*(WORK(IA)-WORK(IB))-S*(WORK(IA+1)+WORK(IB+1)))
     *    -(WORK(IB+1)-WORK(IA+1)))                                     
      IA=IA+NX                                                          
      IB=IB+NX                                                          
      JA=JA+JUMP                                                        
      JB=JB+JUMP                                                        
   20 CONTINUE                                                          
      IABASE=IABASE+2                                                   
      IBBASE=IBBASE-2                                                   
      JABASE=JABASE+INK                                                 
      JBBASE=JBBASE-INK                                                 
   30 CONTINUE                                                          
C                                                                       
      IF (IABASE.NE.IBBASE) GO TO 50                                    
C     WAVENUMBER N/4 (IF IT EXISTS)                                     
      IA=IABASE                                                         
      JA=JABASE                                                         
      SCALE=2.0*SCALE                                                   
CDIR$ IVDEP                                                             
      DO 40 L=1,LOT                                                     
      A(JA)=SCALE*WORK(IA)                                              
      A(JA+INC)=-SCALE*WORK(IA+1)                                       
      IA=IA+NX                                                          
      JA=JA+JUMP                                                        
   40 CONTINUE                                                          
C                                                                       
   50 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE PTOSIG (PSFC, LATCO, SI, ZSTAR, PMAND, ALNP,           
     1 ZP, TP, UP, VP, US, VS, RH, RS, TS , SL )                        
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION SL(KMAX)                                                
      DIMENSION PSFC(LONG ,LATG ), SI(KMXP), PI(KMXP),                  
     1 P(KMXP), ZS(KMXP), ZSTAR(LONG ),                                 
     2 PMAND(MAND), ALNP(MAND), ZP(LONG,MAND), TP(LONG,MAND),                 
     3 PBS(KMXP), UP(LONG,MAND), VP(LONG,MAND),                           
     4 US(LONG ,KMAX), VS(LONG ,KMAX),                                  
     5 RH(LONG,KRHI), RS(LONG ,KMXQ), TS(LONG ,KMAX)                      
      SAVE R,G                                          
      DATA R/2.8705E2/, G/9.8/                                          
      KPMAX = KMXI                                                      
      ROG = R/G                                                         
      JJ = LATCO                                                        
C                                                                       
      DO 1270 I=1,LONG                                                  
C                                                                       
C  DEFINE INTERFACE PRESSURES,P FROM P* AND SI                          
C                                                                       
      DO 400 K = 1,KMXP                                                 
        P(K) = PSFC(I,JJ) * SI(K)                                       
        IF(P(K).LE.0.0) P(K) = 1.0                                      
  400 CONTINUE                                                          
C                                                                       
C     HERE FIND HEIGHTS OF SIGMA SURFACES BY SAME HYDROSTATIC FORMULA   
C                                                                       
C     AND FIND WINDS IN THE D SIGMA LAYERS BY INTERPOLATION FROM        
C     MANDITORY LEVELS  -  INTERPOLATION SAYS WIND COMPONENTS ARE       
C     LINEAR WITH LN(PRESSURE) TO CENTERS OF SIGMA LAYERS.              
C     LATTER DEFINED AS AT LN(PBAR SIG)                                 
C                                                                       
C                                                                       
      P2 = P(1)                                                         
      ZS(1) = ZSTAR(I)                                                  
           DO 190 KS = 1,KMAX                                           
C                                                                       
C     BYPASS FINDING Z FOR SIGMA LEVEL 1                                
C                                                                       
      P1=P(KS+1)                                                        
      IF(KS.EQ.1)  GO TO 160                                            
C                                                                       
C     FIND PRESSURE LEVELS WHICH BRACKET KS SIG LEVEL                   
C                                                                       
      DO 140 K=2,KPMAX                                                  
      KP = K                                                            
      IF(PMAND(K).LE.P2)  GO TO 150                                     
  140 CONTINUE                                                          
150   CONTINUE                                                          
C     HEIGHTS  -  HYDROSTATIC INTERPOLATION                             
C                                                                       
      DH = ALNP(KP-1) - ALNP(KP)                                        
      A = - (ZP(I,KP-1) - ZP(I,KP))/DH                                  
      B = ROG * (TP(I,KP-1) - TP(I,KP))/DH                              
      Z3 = 0.5 * (ZP(I,KP-1) + ZP(I,KP)) + 0.125 * B * (DH**2)          
      HMH3 = ALOG(P2) - 0.5 * (ALNP(KP-1) + ALNP(KP))                   
      ZS(KS) = Z3 - (A + 0.5 * B * HMH3) * HMH3                         
C                                                                       
C     WINDS LINEAR WITH LN(P) INTERPOLATINN                             
C     FIND PRESSURE CENTRAL TO SIGMA LAYER                              
C     ALSO RELATIVE HUMIDITY BUT CAUTION  -                             
C     1)  REL HUM ONLY WANTED FOR 5 LOWEST SIGMA LAYERS                 
C     2)    REL HUM AVAILABLE ONLY ON LOWEST 6 MAND PRESSURE LEVELS     
C      SO WATCH OUT                                                     
C                                                                       
160   PBS(1)=SL(KS)*PSFC(I,JJ)                                          
C                                                                       
C     SEARCH (AGAIN ) FOR BRACKETINF MANDITORY LEVELS                   
C                                                                       
      DO 170 K=2,KPMAX                                                  
      KP = K                                                            
      IF(PMAND(K).LE.PBS(1))  G O TO 180                                
  170 CONTINUE                                                          
C***  IF FALL THRU EQUATE TO 50 MB VALUES                               
      US(I,KS)=UP(I,KMXI)                                               
      VS(I,KS)=VP(I,KMXI)                                               
      IF(KS.GT.KMXQ) GO TO 189                                          
      RS(I,KS)=RH(I,KRHI)                                               
      GO TO 189                                                         
C                                                                       
C     WINDS  -  LINEAR INTERP TO LN(PBS)                                
C                                                                       
  180 U3 = (UP(I,KP-1) + UP(I,KP)) * 0.5                                
      V3 = (VP(I,KP-1) + VP(I,KP)) * 0.5                                
      DH = ALNP(KP-1) - ALNP(KP)                                        
      AU = (UP(I,KP-1) - UP(I,KP))/DH                                   
      AV = (VP(I,KP-1) - VP(I,KP))/DH                                   
      H3MHX = 0.5*(ALNP(KP -1) + ALNP(KP )) - ALOG(PBS(1))              
      US(I,KS) = U3 - AU*H3MHX                                          
      VS(I,KS) = V3 - AV*H3MHX                                          
C                                                                       
      IF(KS.GT.KMXQ) GO TO 189                                          
      IF(KP.GT.KRHI) KP=KRHI                                               
      RH3=(RH(I,KP-1)+RH(I,KP))*0.5                                     
      DH=ALNP(KP-1)-ALNP(KP)                                            
      ARH=(RH(I,KP-1)-RH(I,KP))/DH                                      
      H3MHX=0.5*(ALNP(KP-1) + ALNP(KP))-ALOG(PBS(1))                    
      RS(I,KS) = RH3 - ARH*H3MHX                                        
  189 P2 = P1                                                           
  190 CONTINUE                                                          
C                                                                       
C     HERE FIND TEMPERATURES IN LAYERS                                  
C                                                                       
             DO 230 KS=1,KMAX                                           
      IF(P(KS+1) .GE. PMAND(KPMAX)) GO TO 229                           
      TS(I,KS)=TP(I,KMXI)                                               
      GO TO 230                                                         
229   CONTINUE                                                          
      TS(I,KS) = -1./ROG * (ZS(KS) - ZS(KS+1))/ ALOG(P(KS)/P(KS+1))     
  230 CONTINUE                                                          
C..FIX BY J.GERRITY..........                                           
C                                                                       
C     CORRECTION TO SIGMA LAYER TEMP AND WIND                           
C     WHEN SIGMA LAYER PRESSURE LESS THAN 50 MB.                        
C                                                                       
C     SET ISOTHERMAL TEMPERATURE TO                                     
C     THICKNESS TEMP IMPLIED BY Z AT 50 AND 70 MBS.                     
C     SET WIND SHEAR USING 70 AND 50 MB WINDS                           
C                                                                       
      DH = ALNP(12) - ALNP(11)                                          
      TISO = (ZP(I,11) - ZP(I,12)) / (ROG*DH)                           
      PBARLN = ALOG(59.801166)                                          
      UBAR = 0.5 * (UP(I,11) + UP(I,12))                                
      VBAR = 0.5 * (VP(I,11) + VP(I,12))                                
      DUDLNP = (UP(I,12) - UP(I,11)) / DH                               
      DVDLNP = (VP(I,12) - VP(I,11)) / DH                               
C                                                                       
      DO 300 KS=1,KMAX                                                  
      PBARS = SL(KS) * PSFC(I,JJ)                                       
      IF (PBARS.GE.50.)  GO TO 300                                      
      TS(I,KS) = TISO                                                   
      PBRSLN = ALOG(PBARS)                                              
      DHP = PBRSLN - PBARLN                                             
      SHRU = DUDLNP * DHP                                               
      SHRV = DVDLNP * DHP                                               
      US(I,KS) = UBAR + SHRU                                            
      VS(I,KS) = VBAR + SHRV                                            
C                                                                       
C     BOUND EXTRAPOLATION                                               
C                                                                       
      IF (US(I,KS).GE.+50.)  US(I,KS)= 50.                              
      IF (US(I,KS).LE.-50.)  US(I,KS)=-50.                              
      IF (VS(I,KS).GE.+50.)  VS(I,KS)= 50.                              
      IF (VS(I,KS).LE.-50.)  VS(I,KS)=-50.                              
300   CONTINUE                                                          
C                                                                       
C     END CORRECTION                                                    
 1270 CONTINUE                                                          
C              ENDS THE ROW                                             
      RETURN                                                            
      END                                                               
      SUBROUTINE GETPS (ZP, ZSTAR, ALNP, TP, PSFC, JJ)                  
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION ZP(LONG,MAND), ZSTAR(LONG ),                             
     1 ALNP(MAND), TP(LONG,MAND), PSFC(LONG ,LATG )                        
      SAVE G,R
      DATA G/9.8/, R/2.8705E2/                                          
      DO 270 I=1,LONG                                                   
C                                                                       
C     FIRST COMPUTE SURFACE PRESSURE P* (PSTAR)                         
C     START BY FINDING MANDITORY LEVELS WHICH BRACKET THE GROUND (Z*)   
C                                                                       
      DO 100 K=2,KMXI                                                   
      KP = K                                                            
      IF(ZP(I,K).GE.ZSTAR(I))  GO TO 110                                
  100 CONTINUE                                                          
C                                                                       
C     NEXT THE SURFACE PRESSURE I VIA THE HYDROSTATIC FORMALA           
C                                                                       
CX
CX   WRITE(6,7010) I,KP
C7010 FORMAT(' IN SUBOURINTE GETPS  I= ',I3,' KP = ',I3)
  110 DH = ALNP(KP-1) - ALNP(KP)                                        
      DPHI = G * (ZP(I,KP-1) - ZP(I,KP))                                
      A = -DPHI/DH                                                      
      B = R*(TP(I,KP-1) - TP(I,KP))/DH                                  
      PHI3 = 0.5 * G * (ZP(I,KP-1) + ZP(I,KP)) + 0.125 *B*(DH**2)       
      SQ = A**2 - 2.*B * (G*ZSTAR(I) - PHI3)                            
      IF(SQ.GE.0.)  GO TO 130                                           
      PRINT 120                                                         
  120 FORMAT('1 DISASTER - NEG SQRT IN PSTAR.')                         
CX
      STOP
  130 ALNPS = 0.5 * (ALNP(KP-1) + ALNP(KP)) - 2. * (G*ZSTAR(I) - PHI3)/ 
     1                                            (A + SQRT(SQ))        
      PSFC(I,JJ) = ALNPS                                                
  270 CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE  LOWTMP(ZSV,TSV)                                       
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      PARAMETER (NAT=2*KMXI,NWRK=MAND+4)
       REAL  ZSV,TSV,PRESS                                              
      DIMENSION PRESS(MAND),AINV(MAND,MAND),AUNK(MAND)
      DIMENSION  AT(MAND,NAT), ATA(MAND,MAND)
      DIMENSION  DELTZ(MAND),RPL(MAND),DLG(MAND)                          
      DIMENSION  UNK(NAT), Q(MAND,NWRK), AC(MAND),BC(MAND)
      DIMENSION  TBAR(MAND),ZSV(MAND),TSV(MAND)                                
      SAVE PRESS,ISWTCH,SCLT,MLVL,RPL,DLG,NLVLM,AC,BC,NLVLP,NLVLPP,
     *AT,ATA,Q,AINV,NLVLPX
      DATA PRESS/1000.,850.,700.,500.,400.,300.,250.,200.,150.,100.,    
     1           70.,50./                                   
      DATA ISWTCH/0/                                                    
      IF(ISWTCH.NE.0) GO TO 90                                          
      SCLT=-9.8   /287.0                                                
      MLVL= KMXI                                                        
      DO 10  I=1,MAND                                                   
      XX=PRESS(I)                                                       
      RPL(I)= LOG (XX)                                                  
 10   CONTINUE                                                          
      DO 20  I=2,MAND                                                   
      DLG(I)=RPL(I)-RPL(I-1)                                            
      DLG(I)=1.0   /DLG(I)                                              
 20   CONTINUE                                                          
      NLVLM=MLVL-1                                                      
      AC(1)=0.0                                                         
      BC(1)=AC(1)                                                       
      AC(MLVL)=AC(1)                                                    
      BC(MLVL)=AC(1)                                                    
      DO 30  K=2,NLVLM                                                  
      AC(K)=(RPL(K+1)-RPL(K))/(RPL(K+1)-RPL(K-1))                       
       BC(K)=(RPL(K)-RPL(K-1))/(RPL(K+1)-RPL(K-1))                      
 30   CONTINUE                                                          
      NLVLP=NLVLM+MLVL-1                                                
      NLVLPP=NLVLP+1                                                    
      DO 40  I=1,NAT                                                    
      DO 40  J=1,MAND                                                   
      AT(J,I)=0.0                                                       
 40   CONTINUE                                                          
      DO 50  I=1,NLVLM                                                  
      AT(I,I)=0.5                                                       
      AT(I+1,I)=AT(I,I)                                                 
 50   CONTINUE                                                          
      DO 60  I=1,MLVL                                                   
      AT(I,I+NLVLM)=1.0                                                 
 60   CONTINUE                                                          
      DO 80  I=1,MLVL                                                   
      DO 80  J=1,MLVL                                                   
      ATA(I,J)=0.0                                                      
      DO 70  K=1,NLVLPP                                                 
      ATA(I,J)=ATA(I,J)+AT(I,K)*AT(J,K)                                 
 70   CONTINUE                                                          
 80   CONTINUE                                                          
      CALL ERWINA(MLVL,ATA(1,1),AINV(1,1),Q(1,1),MAND)                  
      NLVLPX=NLVLP-1                                                    
  90  CONTINUE                                                          
      ISWTCH=1                                                          
      DO 100  I=2,MLVL                                                  
C   DELTZ IN M.                                                         
      DELTZ(I)=ZSV(I)-ZSV(I-1)                                          
 100  CONTINUE                                                          
      DO 110  K=2,MLVL                                                  
      TBAR(K)=DELTZ(K)*DLG(K)                                           
 110  CONTINUE                                                          
      DO 120  I=1,NLVLM                                                 
      UNK(I)=TBAR(I+1)                                                  
 120  CONTINUE                                                          
      I3=1                                                              
      DO 130  I=MLVL,NLVLPX                                             
      I3=I3+1                                                           
      UNK(I+1)=AC(I3)*TBAR(I3)+BC(I3)*TBAR(I3+1)                        
 130  CONTINUE                                                          
      UNK(MLVL)=-UNK(MLVL+1)+2.0   *TBAR(2)                             
      UNK(NLVLPP)=-UNK(NLVLP)+2.0   *TBAR(MLVL)                         
      DO 150  I=1,MLVL                                                  
      AUNK(I)=0.0                                                       
      DO 140  J=  1,NLVLPP                                              
      AUNK(I)=AUNK(I)+AT(I,J)*UNK(J)                                    
 140  CONTINUE                                                          
 150  CONTINUE                                                          
      DO 170  I=1,MLVL                                                  
      TSVXIX=0.0                                                        
      DO 160  J=1,MLVL                                                  
      TSVXIX=TSVXIX+AINV(I,J)*AUNK(J)                                   
 160  CONTINUE                                                          
C   TSV IN DEG CELSIUS.                                                 
      TSV(I)=TSVXIX*SCLT                                                
 170  CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE ERWINA (N, Q, F, A, MTXD)                              
CNP   ERWINA                                                            
C          SUBROUTINE INVERTS N BY N MATRIX (OR SUBMATRIX)              
C          DETERMINENT OF MATRIX IS CALCULATED AS D -- SUBROUTINE CAN BE
C             MODIFIED TO INCLUDE D IN CALL SEQUENCE.                   
C          ARGUMENTS (WITH DIMENSIONS) ARE                              
C             N                   -- SIZE OF (SUB)MATRIX TO BE INVERTED 
C             Q(MTXD  , MTXD  )   -- INPUT MATRIX                       
C             F(MTXD  , MTXD  )   -- RESULTANT INVERTED MATRIX          
C             A(MTXD  , MTXD  +4) -- WORK ARRAY                         
C             MTXD                -- ARRAY DIMENSIONS OF ACTUAL ARRAYS  
      DIMENSION Q(MTXD  , *), F(MTXD  , *), A(MTXD  , *)                
C          LOAD WORK ARRAY WITH INPUT VALUES                            
      DO 10 J=1,N                                                       
      DO 10 I=1,N                                                       
 10   A(I,J)=Q(I,J)                                                     
      D=1.0                                                             
        I = 1                                                           
      DO 110 J=1,N                                                      
        GO TO (60,40,20),I                                              
 20     K = J-2                                                         
      DO 30 L=1,K                                                       
      DO 30 M=J,N                                                       
 30     A(J-1,M) = A(J-1,M) - A(L,J-1)*A(L,M)                           
 40     K = J-1                                                         
      DO 50 L=1,K                                                       
 50     A(J,J) = A(J,J) - A(L,J)*A(L,J)                                 
        I = 2                                                           
 60     D = D*A(J,J)                                                    
      IF(A(J,J)) 70, 70, 80                                             
 70   GO TO 190                                                         
 80      A(J,N+3) = SQRT  (A(J,J))                                      
      DO 90 L=J,N                                                       
 90     A(J,L) = A(J,L)/A(J,N+3)                                        
      DO 100 L=1,J                                                      
 100    A(L,J) = A(L,J)/A(J,N+3)                                        
 110    I = I+1                                                         
C     INVERSION OF U                                                    
      DO 120 I=2,N                                                      
        J = I-1                                                         
      DO 120 K=1,J                                                      
 120    A(I,K) = -A(K,I)                                                
      DO 130 I=3,N                                                      
        J = I-2                                                         
      DO 130 K=1,J                                                      
        L = I-K-1                                                       
        M = I                                                           
      DO 130 IJ=1,K                                                     
        M = M-1                                                         
 130    A(I,L) = A(I,L) - A(I,M)*A(L,M)                                 
C     COMPUTATION OF U INVERSE * U INVERSE TRANSPOSE                    
      DO 150 I=1,N                                                      
      DO 150 J=I,N                                                      
        A(I,N+4) = 0.0                                                  
      DO 140 K=J,N                                                      
 140    A(I,N+4) = A(I,N+4) + A(K,I)*A(K,J)                             
 150    A(I,J) = A(I,N+4)                                               
      DO 160 I=1,N                                                      
      DO 160 J=I,N                                                      
 160    A(I,J) = A(I,J)/A(I,N+3)                                        
      DO 170 I=1,N                                                      
      DO 170 J=1,I                                                      
 170    A(J,I) = A(J,I)/A(I,N+3)                                        
      DO 180 K=1,N                                                      
      DO 180 L=K,N                                                      
 180    A(L,K) = A(K,L)                                                 
 190  CONTINUE                                                          
C          MOVE RESULTS TO OUTPUT ARRAY                                 
      DO 200 J=1,N                                                      
      DO 200 I=1,N                                                      
      F(I,J)=A(I,J)                                                     
 200  CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE SUMPLS(FLN,AP,AM,PLN)                                  
C     SR COMPUTES FOURIER MULTIPLIERS                                   
C     IN AP COEFFS. OF SYMMETRIC LEGENDRES                              
C     IN AM COEFFS. OF ANTISYM.  LEGENDRES                              
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION AP(NWS ),AM(NWS ),                                      
     1PLN(NWV ,NWS ),FLN(NWS ,NWS )                                     
      COMPLEX AP,AM,FLN                                                 
      SAVE NEVEN,NODD,IFIRST
      DATA IFIRST/1/
      IF(IFIRST.NE.0)THEN
      IF(MOD(NWS,2).EQ.0)THEN
      NEVEN=NWS
      NODD=NWS-1
      ELSE
      NEVEN=NWS-1
      NODD=NWS
      END IF
      IFIRST=0
      END IF
      DO 3 L=1,NWS                                                      
      CRP=0.                                                            
      CIP=0.                                                            
      DO 1 I=1,NODD,2                                                   
      CRP=CRP+PLN(I,L)* REAL(FLN(I,L))                                  
      CIP=CIP+PLN(I,L)*AIMAG(FLN(I,L))                                  
1     CONTINUE                                                          
      CRM=0.                                                            
      CIM=0.                                                            
      DO 2 I=2,NEVEN,2                                                  
      CRM=CRM+PLN(I,L)* REAL(FLN(I,L))                                  
      CIM=CIM+PLN(I,L)*AIMAG(FLN(I,L))                                  
2     CONTINUE                                                          
      AP(L)=CMPLX(CRP+CRM,CIP+CIM)                                      
      AM(L)=CMPLX(CRP-CRM,CIP-CIM)                                      
3     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE SUMPLV(VLN,AP,AM,PLN)                                  
C     SR COMPUTES FOURIER MULTIPLIERS                                   
C     IN AP COEFFS. OF SYMMETRIC LEGENDRES                              
C     IN AM COEFFS. OF ANTISYM.  LEGENDRES                              
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION AP(NWS ),AM(NWS ),                                      
     1PLN(NWV ,NWS ),VLN(NWV ,NWS )                                     
      COMPLEX AP,AM,VLN                                                 
      SAVE NEVEN,NODD,IFIRST
      DATA IFIRST/1/
      IF(IFIRST.NE.0)THEN
      IF(MOD(NWV,2).EQ.0)THEN
      NEVEN=NWV
      NODD=NWV-1
      ELSE
      NEVEN=NWV-1
      NODD=NWV
      END IF
      IFIRST=0
      END IF
      DO 3 L=1,NWS                                                      
      CRP=0.                                                            
      CIP=0.                                                            
      DO 1 I=1,NODD,2                                                   
      CRP=CRP+PLN(I,L)* REAL(VLN(I,L))                                  
      CIP=CIP+PLN(I,L)*AIMAG(VLN(I,L))                                  
1     CONTINUE                                                          
      CRM=0.                                                            
      CIM=0.                                                            
      DO 2 I=2,NEVEN,2                                                   
      CRM=CRM+PLN(I,L)* REAL(VLN(I,L))                                  
      CIM=CIM+PLN(I,L)*AIMAG(VLN(I,L))                                  
2     CONTINUE                                                          
      AP(L)=CMPLX(CRP+CRM,CIP+CIM)                                      
      AM(L)=CMPLX(CRP-CRM,CIP-CIM)                                      
3     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE SYMASY (A,B)                                           
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION A(NWS ),B(NWS )                                         
      DIMENSION C(NWS ),D(NWS )                                         
      COMPLEX A,B                                                       
      COMPLEX C,D                                                       
C     ON INPUT A CORRESP. TO N. HEMIS. FOURIERS                         
C     ON INPUT B CORRESP. TO S. HEMIS. FOURIERS                         
C     ON OUTPUT A CORRESP. TO MULTIPLIERS OF SYM. PLN                   
C     ON OUTPUT B CORRESP. TO MULTIPLIERS OF ANTISYM. PLN               
C                                                                       
      DO 1 I = 1,NWS                                                    
      C(I) = A(I)                                                       
      D(I) = B(I)                                                       
1     CONTINUE                                                          
C                                                                       
      DO 2 I = 1,NWS                                                    
      A(I) = C(I) + D(I)                                                
      B(I) = C(I) - D(I)                                                
2     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE MOVEFF(A,B)                                            
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION A(NWS ), B(NWS )                                        
      COMPLEX A,B                                                       
C     NOTE. A IN CALL IS REAL LATITUDE CIRCLE                           
      DO 1 I=1,NWS                                                      
      A(I) = B(I)                                                       
1     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE PLN2 (PLN, COLRAD, LAT, XXX)                           
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION PLN( NRV  ), COLRAD(LATH), SSS( NRV  )                  
      DOUBLE PRECISION         SSS, SINLAT, COS2, PROD,                 
     1 A, B, FL, ALP1, ALP2, ALP3                                       
      SAVE JCAP,JCAP1,JCAP2,SSS,IST
      DATA IST/0/                                                       
      IF(IST.EQ.1) GO TO 555                                            
      CALL ERRSET(208,256,-1,0,0,0)                                     
      JCAP= NWS-1                                                       
      JCAP1 = JCAP + 1                                                  
      JCAP2 = JCAP + 2                                                  
       DO 111 LL=1,JCAP1                                                
      L = LL - 1                                                        
      JLE = (LL-1) * JCAP2                                              
      DO 111 INDE=2,JCAP2                                               
      N = L + INDE - 1                                                  
      A = DFLOAT(N*N-L*L) / DFLOAT(4*N*N-1)                             
      SSS(JLE+INDE) = DSQRT(A)                                          
111   CONTINUE                                                          
       DO 222 LL=1,JCAP1                                                
      JLE = (LL-1) * JCAP2                                              
      SSS(JLE+1) = 0.D+0                                                
222   CONTINUE                                                          
555   CONTINUE                                                          
      IST=1                                                             
      SINLAT =  COS(COLRAD(LAT))                                        
      COS2 = 1.D+0 - SINLAT * SINLAT                                    
      PROD = 1.D+0                                                      
      A = 1.D+0                                                         
      B = 0.D+0                                                         
      DO 30 LL=1,NWS                                                    
      L = LL - 1                                                        
      FL = L                                                            
      JLE = L *  NWV                                                    
      IF (L.EQ.0) GO TO 12                                              
      A = A + 2.D+0                                                     
      B = B + 2.D+0                                                     
      PROD = PROD * COS2 * A / B                                        
12    CONTINUE                                                          
      ALP1 = DSQRT (0.5D+0 * PROD)                                      
      PLN(JLE+1) = SNGL(ALP1)                                           
      ALP2 = DSQRT(2.D+0 * FL + 3.D+0) * SINLAT * ALP1                  
      PLN(JLE+2) = SNGL(ALP2)                                           
      DO 20 N=3,NWV                                                     
      MN = JLE + N                                                      
      ALP3 = (SINLAT*ALP2 - SSS(MN-1)*ALP1)/SSS(MN)                     
      PLN(MN) = SNGL(ALP3)                                              
      ALP1 = ALP2                                                       
      ALP2 = ALP3                                                       
20    CONTINUE                                                          
30    CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE NEGPLN(PLN)                                            
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION PLN( NRV  )                                             
C SUB. CHANGES SIGN OF ASYM. PLN IN S. HEMI.                            
      SAVE NEVEN,IFIRST
      DATA IFIRST/1/
      IF(IFIRST.NE.0)THEN
      IF(MOD(NWV,2).EQ.0)THEN
      NEVEN=NWV
      ELSE
      NEVEN=NWV-1
      END IF
      IFIRST=0
      END IF
      DO 2 LL=1,NWS                                                     
      JLE=(LL-1)*NWV                                                    
      DO 1 IND=2,NEVEN,2                                                 
      PLN(JLE+IND)=-PLN(JLE+IND)                                        
1     CONTINUE                                                          
2     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE EPSLON (EPS,JCAP)                                      
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION EPS( NRV  )                                             
      JCAP1 = JCAP + 1                                                  
      JCAP2 = JCAP + 2                                                  
      DO 1 LL=1,JCAP1                                                   
      L = LL - 1                                                        
      JLE = (LL-1) * JCAP2                                              
      DO 1 INDE=2,JCAP2                                                 
      N = L + INDE - 1                                                  
      A =  FLOAT(N*N-L*L) /  FLOAT(4*N*N-1)                             
      EPS(JLE+INDE) =  SQRT(A)                                          
1     CONTINUE                                                          
      DO 2 LL=1,JCAP1                                                   
      JLE = (LL-1) * JCAP2                                              
      EPS(JLE+1) = 0.0                                                  
2     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE GLATS(KHALF,COLRAD,WGT,WGTCS,RCS2)                     
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION COLRAD(LATH),WGT(LATH),WGTCS(LATH),RCS2(LATH)           
      DOUBLE PRECISION        EPS, SI, RK2, SCALE, PI, DRADZ, RAD,      
     1 DRAD, P1, P2, PHI, W, X, SN, RC                                  
      EPS=1.D-12                                                        
C     PRINT 101                                                         
C101  FORMAT ('0 I   COLAT   COLRAD     WGT', 12X, 'WGTCS',             
C    1 10X, 'ITER  RES')                                                
      SI=1.D+00                                                         
      K2=2*KHALF                                                        
      RK2=K2                                                            
      SCALE=2.D+00/(RK2**2)                                             
      K1=K2-1                                                           
      PI=DATAN(SI)*4.D+00                                               
      DRADZ=PI/360.D+00                                                 
      RAD=0.D+00                                                        
      DO 1000 K=1,KHALF                                                 
      ITER=0                                                            
      DRAD=DRADZ                                                        
1     CONTINUE                                                          
      CALL POLY(K2,RAD,P2)                                              
2     CONTINUE                                                          
      P1 = P2                                                           
      ITER=ITER+1                                                       
      RAD=RAD+DRAD                                                      
      CALL POLY(K2,RAD,P2)                                              
      IF(DSIGN(SI,P1).EQ.DSIGN(SI,P2))GO TO 2                           
      IF(DRAD.LT.EPS)GO TO 3                                            
      RAD=RAD-DRAD                                                      
      DRAD=DRAD*0.25D+00                                                
      GO TO 1                                                           
3     CONTINUE                                                          
      COLRAD(K)=SNGL(RAD)                                               
      PHI=RAD   *180.D+00/PI                                            
      CALL POLY(K1,RAD,P1)                                              
      X=DCOS(RAD)                                                       
      W=SCALE*(1.D+00-X*X)/(P1*P1)                                      
      WGT(K)=SNGL(W)                                                    
      SN=DSIN(RAD)                                                      
      W=W/(SN*SN)                                                       
      WGTCS(K)=SNGL(W)                                                  
      RC=1./(SN*SN)                                                     
      RCS2(K)=SNGL(RC)                                                  
      CALL POLY(K2,RAD,P1)                                              
      PRPHI = SNGL(PHI)                                                 
      PRCOL = COLRAD(K)                                                 
C     PRINT 102, K, PRPHI, PRCOL, WGT(K), WGTCS(K), ITER, P1            
C102  FORMAT(1H ,I2,2X,F6.2,2X,F10.7,2X,E13.7,2X,E13.7,2X,I4,2X,D13.7)  
1000  CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE POLY(N,RAD,P)                                          
      DOUBLE PRECISION X,RAD,P,Y1,Y2,Y3,G                               
      X=DCOS(RAD)                                                       
      Y1=1.D+0                                                          
      Y2=X                                                              
      DO 1 I=2,N                                                        
      G=X*Y2                                                            
      Y3=G-Y1+G-(G-Y1)/FLOAT(I)                                         
      Y1=Y2                                                             
      Y2=Y3                                                             
1     CONTINUE                                                          
      P=Y3                                                              
      RETURN                                                            
      END                                                               
      SUBROUTINE UVDZ99(D,Z,PLN,COLRAD,DER,EPS,PLNWCS,                  
     1WGTCS,U,V,DLAM,DLAMF,DPHI,DPHIF,AF,BF,GF,FF)                      
C     SR GLATS MUST BE CALLED BEFORE CALLING THIS SR***********         
C     SR COMPUTES DIV VORT FROM U V COEF. VIA GRID                      
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      PARAMETER (LONH=LONG/2)
      COMPLEX   Z( NRS  ),D( NRS  ),U( NRV  ),V( NRV  ),                
     1DLAMF(NWS ),DPHIF(NWS ),AF(LONH),BF(LONH),                        
     2GF(LONH),FF(LONH)                                                 
      DIMENSION DLAM(LONG ),DPHI(LONG ),                                
     1PLN( NRV  ),DER( NRS  ),PLNWCS( NRS  ),WGTCS(LATH)                
      COMMON    /WORK99/ WORK(LONG )                                    
      DIMENSION    EPS( NRV  ),COLRAD(LATH)                             
      DO 15 I=1,NRS                                                     
      D(I)=(0.,0.)                                                      
      Z(I)=(0.,0.)                                                      
15    CONTINUE                                                          
      DO 2000 LAT=1,LATH                                                
      CALL PLN2(PLN,COLRAD,LAT,EPS)                                     
      CALL PLNDER(PLN,DER,EPS,LAT,PLNWCS,WGTCS)                         
      CALL SUMPLV(U,DLAM,DLAMF,PLN)                                     
      CALL SUMPLV(V,DPHI,DPHIF,PLN)                                     
      CALL FFS99(DPHI,WORK,1)                                           
      CALL FFS99(DLAM,WORK,1)                                           
      CALL FFA99(DPHI,AF,WORK,1)                                        
      CALL FFA99(DLAM,BF,WORK,1)                                        
      CALL  MOVEFF(DLAM,DLAMF)                                          
      CALL  MOVEFF(DPHI,DPHIF)                                          
      CALL FFS99 (DPHI,WORK,1)                                          
      CALL FFS99 (DLAM,WORK,1)                                          
      CALL FFA99 (DPHI,GF,WORK,1)                                       
      CALL FFA99 (DLAM,FF,WORK,1)                                       
      CALL SYMASY(AF,GF)                                                
      CALL SYMASY(BF,FF)                                                
      CALL MSUM2(FF,BF,GF,AF,D     ,PLNWCS,DER)                         
      CALL PSUM2(FF,BF,GF,AF,Z     ,PLNWCS,DER)                         
2000  CONTINUE                                                          
      DO 20 I=1, NRS                                                    
      D(I)=-D(I)                                                        
20    CONTINUE                                                          
      RETURN                                                            
      END                                                               
      SUBROUTINE PLNDER (PLN, DER, EPS, LAT, PLNWCS, WGTCS)             
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION PLN( NRV  ), DER( NRS  ), EPS( NRV  ),                  
     1  PLNWCS( NRS  ), WGTCS(LATH)                                     
C     COMPUTE PLN DERIVATIVES                                           
      DO 3 LL=1,NWS                                                     
      L = LL - 1                                                        
      JL = L * NWS                                                      
      JLE = L * NWV                                                     
      N=L                                                               
      DER(JL+1) = -FLOAT(N) *  (EPS(JLE+2)) * PLN(JLE+2)                
      DO 2 IND=2,NWS                                                    
      N = N + 1                                                         
      DER(JL+IND) = FLOAT(N+1) *  (EPS(JLE+IND  )) * PLN(JLE+IND-1)     
     1            - FLOAT(N  ) *  (EPS(JLE+IND+1)) * PLN(JLE+IND+1)     
2     CONTINUE                                                          
3     CONTINUE                                                          
      WCSA = WGTCS(LAT) /  6370000.                                     
      DO 4 I=1, NRS                                                     
      DER(I) = DER(I) * WCSA                                            
4     CONTINUE                                                          
      DO 6 LL=1,NWS                                                     
      JL = (LL-1) * NWS                                                 
      JLE = (LL-1) * NWV                                                
      DO 5 IND=1,NWS                                                    
      PLNWCS(JL+IND) = PLN(JLE+IND) * WCSA                              
5     CONTINUE                                                          
6     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE PSUM2(AM,AP,BM,BP,FLN,PLNWCS,DER)                      
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION AM(NWS ),AP(NWS ),BM(NWS ),BP(NWS ),                    
     1FLN(NWS ,NWS ),PLNWCS(NWS ,NWS ),DER(NWS ,NWS )                   
      COMPLEX AM,AP,BM,BP,FLN                                           
      SAVE NEVEN,NODD,IFIRST
      DATA IFIRST/1/
      IF(IFIRST.NE.0)THEN
      IF(MOD(NWS,2).EQ.0)THEN
      NEVEN=NWS
      NODD=NWS-1
      ELSE
      NEVEN=NWS-1
      NODD=NWS
      END IF
      IFIRST=0
      END IF
      DO 3 LL=1,NWS                                                     
      DO 1 I=1,NODD,2                                                   
      FLN(I,LL) = FLN(I,LL) + CMPLX (                                   
     1  REAL(AM(LL))*DER(I,LL)+FLOAT(1-LL)*AIMAG(BP(LL))*PLNWCS(I,LL) , 
     2 AIMAG(AM(LL))*DER(I,LL)+FLOAT(LL-1)* REAL(BP(LL))*PLNWCS(I,LL) ) 
1     CONTINUE                                                          
      DO 2 I=2,NEVEN,2                                                  
      FLN(I,LL) = FLN(I,LL) + CMPLX (                                   
     1  REAL(AP(LL))*DER(I,LL)+FLOAT(1-LL)*AIMAG(BM(LL))*PLNWCS(I,LL) , 
     2 AIMAG(AP(LL))*DER(I,LL)+FLOAT(LL-1)* REAL(BM(LL))*PLNWCS(I,LL) ) 
2     CONTINUE                                                          
3     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE MSUM2(AM,AP,BM,BP,FLN,PLNWCS,DER)                      
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      DIMENSION AM(NWS ),AP(NWS ),BM(NWS ),BP(NWS ),                    
     1FLN(NWS ,NWS ),PLNWCS(NWS ,NWS ),DER(NWS ,NWS )                   
      COMPLEX AM,AP,BM,BP,FLN                                           
      SAVE NEVEN,NODD,IFIRST
      DATA IFIRST/1/
      IF(IFIRST.NE.0)THEN
      IF(MOD(NWS,2).EQ.0)THEN
      NEVEN=NWS
      NODD=NWS-1
      ELSE
      NEVEN=NWS-1
      NODD=NWS
      END IF
      IFIRST=0
      END IF
      DO 3 LL=1,NWS                                                     
      DO 1 I=1,NODD,2                                                   
      FLN(I,LL) = FLN(I,LL) + CMPLX (                                   
     1  REAL(BM(LL))*DER(I,LL)+FLOAT(LL-1)*AIMAG(AP(LL))*PLNWCS(I,LL) , 
     2 AIMAG(BM(LL))*DER(I,LL)+FLOAT(1-LL)* REAL(AP(LL))*PLNWCS(I,LL) ) 
1     CONTINUE                                                          
      DO 2 I=2,NEVEN,2                                                  
      FLN(I,LL) = FLN(I,LL) + CMPLX (                                   
     1  REAL(BP(LL))*DER(I,LL)+FLOAT(LL-1)*AIMAG(AM(LL))*PLNWCS(I,LL) , 
     2 AIMAG(BP(LL))*DER(I,LL)+FLOAT(1-LL)* REAL(AM(LL))*PLNWCS(I,LL) ) 
2     CONTINUE                                                          
3     CONTINUE                                                          
C(DEBUGLINE)ANSI VER CREATED SEP 30 1982 BY J.SELA,NMC.                 
      RETURN                                                            
      END                                                               
      SUBROUTINE IMINV (A,N,D,L,M)                                      
C                                                                       
C     ..................................................................
C                                                                       
C        SUBROUTINE IMINV                                               
C                                                                       
C        PURPOSE                                                        
C           INVERT A MATRIX                                             
C                                                                       
C        USAGE                                                          
C           CALL IMINV (A,N,D,L,M)                                      
C                                                                       
C        DESCRIPTION OF PARAMETERS                                      
C           A - INPUT MATRIX, DESTROYED IN COMPUTATION AND REPLACED BY  
C               RESULTANT INVERSE.                                      
C           N - ORDER OF MATRIX A                                       
C           D - RESULTANT DETERMINANT                                   
C           L - WORK VECTOR OF LENGTH N                                 
C           M - WORK VECTOR OF LENGTH N                                 
C                                                                       
C        REMARKS                                                        
C           MATRIX A MUST BE A GENERAL MATRIX                           
C                                                                       
C        SUBROUTINES AND FUNCTION SUBPROGRAMS REQUIRED                  
C           NONE                                                        
C                                                                       
C        METHOD                                                         
C           THE STANDARD GAUSS-JORDAN METHOD IS USED. THE DETERMINANT   
C           IS ALSO CALCULATED. A DETERMINANT OF ZERO INDICATES THAT    
C           THE MATRIX IS SINGULAR.                                     
C                                                                       
C     ..................................................................
C                                                                       
      DIMENSION A(*),L(*),M(*)                                          
C                                                                       
C        ...............................................................
C                                                                       
C        IF A DOUBLE PRECISION VERSION OF THIS ROUTINE IS DESIRED, THE  
C        C IN COLUMN 1 SHOULD BE REMOVED FROM THE DOUBLE PRECISION      
C        STATEMENT WHICH FOLLOWS.                                       
C                                                                       
C     DOUBLE PRECISION A, D, BIGA, HOLD                                 
C                                                                       
C        THE C MUST ALSO BE REMOVED FROM DOUBLE PRECISION STATEMENTS    
C        APPEARING IN OTHER ROUTINES USED IN CONJUNCTION WITH THIS      
C        ROUTINE.                                                       
C                                                                       
C        THE DOUBLE PRECISION VERSION OF THIS SUBROUTINE MUST ALSO      
C        CONTAIN DOUBLE PRECISION FORTRAN FUNCTIONS.  ABS IN STATEMENT  
C        10 MUST BE CHANGED TO DABS.                                    
C                                                                       
C        ...............................................................
C                                                                       
C        SEARCH FOR LARGEST ELEMENT                                     
C                                                                       
      D=1.0                                                             
      NK=-N                                                             
      DO 80 K=1,N                                                       
      NK=NK+N                                                           
      L(K)=K                                                            
      M(K)=K                                                            
      KK=NK+K                                                           
      BIGA=A(KK)                                                        
      DO 20 J=K,N                                                       
      IZ=N*(J-1)                                                        
      DO 20 I=K,N                                                       
      IJ=IZ+I                                                           
C  10 IF (DABS(BIGA)-DABS(A(IJ))) 15,20,20                              
   10 IF(ABS(BIGA)-ABS(A(IJ))) 15,20,20                                 
   15 BIGA=A(IJ)                                                        
      L(K)=I                                                            
      M(K)=J                                                            
   20 CONTINUE                                                          
C                                                                       
C        INTERCHANGE ROWS                                               
C                                                                       
      J=L(K)                                                            
      IF(J-K) 35,35,25                                                  
   25 KI=K-N                                                            
      DO 30 I=1,N                                                       
      KI=KI+N                                                           
      HOLD=-A(KI)                                                       
      JI=KI-K+J                                                         
      A(KI)=A(JI)                                                       
   30 A(JI) =HOLD                                                       
C                                                                       
C        INTERCHANGE COLUMNS                                            
C                                                                       
   35 I=M(K)                                                            
      IF(I-K) 45,45,38                                                  
   38 JP=N*(I-1)                                                        
      DO 40 J=1,N                                                       
      JK=NK+J                                                           
      JI=JP+J                                                           
      HOLD=-A(JK)                                                       
      A(JK)=A(JI)                                                       
   40 A(JI) =HOLD                                                       
C                                                                       
C        DIVIDE COLUMN BY MINUS PIVOT (VALUE OF PIVOT ELEMENT IS        
C        CONTAINED IN BIGA)                                             
C                                                                       
   45 IF(BIGA) 48,46,48                                                 
   46 D=0.0                                                             
      RETURN                                                            
   48 DO 55 I=1,N                                                       
      IF(I-K) 50,55,50                                                  
   50 IK=NK+I                                                           
      A(IK)=A(IK)/(-BIGA)                                               
   55 CONTINUE                                                          
C                                                                       
C        REDUCE MATRIX                                                  
C                                                                       
      DO 65 I=1,N                                                       
      IK=NK+I                                                           
      IJ=I-N                                                            
      DO 65 J=1,N                                                       
      IJ=IJ+N                                                           
      IF(I-K) 60,65,60                                                  
   60 IF(J-K) 62,65,62                                                  
   62 KJ=IJ-I+K                                                         
      A(IJ)=A(IK)*A(KJ)+A(IJ)                                           
   65 CONTINUE                                                          
C                                                                       
C        DIVIDE ROW BY PIVOT                                            
C                                                                       
      KJ=K-N                                                            
      DO 75 J=1,N                                                       
      KJ=KJ+N                                                           
      IF(J-K) 70,75,70                                                  
   70 A(KJ)=A(KJ)/BIGA                                                  
   75 CONTINUE                                                          
C                                                                       
C        PRODUCT OF PIVOTS                                              
C                                                                       
      D=D*BIGA                                                          
C                                                                       
C        REPLACE PIVOT BY RECIPROCAL                                    
C                                                                       
      A(KK)=1.0/BIGA                                                    
   80 CONTINUE                                                          
C                                                                       
C        FINAL ROW AND COLUMN INTERCHANGE                               
C                                                                       
      K=N                                                               
  100 K=(K-1)                                                           
      IF(K) 150,150,105                                                 
  105 I=L(K)                                                            
      IF(I-K) 120,120,108                                               
  108 JQ=N*(K-1)                                                        
      JR=N*(I-1)                                                        
      DO 110 J=1,N                                                      
      JK=JQ+J                                                           
      HOLD=A(JK)                                                        
      JI=JR+J                                                           
      A(JK)=-A(JI)                                                      
  110 A(JI) =HOLD                                                       
  120 J=M(K)                                                            
      IF(J-K) 100,100,125                                               
  125 KI=K-N                                                            
      DO 130 I=1,N                                                      
      KI=KI+N                                                           
      HOLD=A(KI)                                                        
      JI=KI-K+J                                                         
      A(KI)=-A(JI)                                                      
  130 A(JI) =HOLD                                                       
      GO TO 100                                                         
  150 RETURN                                                            
      END                                                               
      SUBROUTINE EXMOIS(PSTAR,QIN,T,QEXTP,LAT,XLAT)                     
C                                                                       
C                                                                       
C  THIS CODE EXTRAPOLATES MOISTURE UP INTO MODEL DRY LAYERS             
C  USING EXPONENTIAL DECREASE UP TO A SPECIFIED Q AT 80 MB,             
C  THEN USE LIMS PROFILE ABOVE(SEE MIDDLE ATMOS PROGRAM HANDBOOK,       
C  VOL 22,SEP 86,ED. J.M.RUSSELL ---> J ALPERT HAS COPY)....            
C                                                                       
C  INPUT - SFC PRES (CB) - PSTAR                                        
C        - MOISTURE      - QIN - LEVH LYRS ONLY                         
C        - TEMPERATURE   - T   - MODEL VIRTUAL TEMPERATURE              
C        - XLAT=LAT IN RADIANS--                                        
C  OUTPUT - LEVS MOISTURE LYRS - QEXTP (USE LIMS DATA ABUV 8 CB)        
C         - THERMODYNAMIC TEMPERATURE BACK INTO T                       
C                                                                       
CX    PARAMETER (NWS=41,NWV=42,KMAX=18,KMXI=12,KRHI=6,MAND=15,
      PARAMETER (NWS=16,NWV=17,KMAX=18,KMXI=12,KRHI=6,MAND=12,
CX   *LONG=128,LATG=102,KMXQ=12,
     *LONG= 48,LATG= 40,KMXQ=12,
     *LATH=LATG/2,KMXP=KMAX+1,KMXM=KMAX-1,
     *NTS=NWS*NWS*2,NTV=NWS*NWV*2,
     *NRS=NWS*NWS,NRV=NWS*NWV)
      PARAMETER(IDIM=LONG,JDIM=LATG,                     
     1          KDIM=KMAX,KDIMQ=KMXQ)                          
C                                                                       
      PARAMETER(KDIMP=KDIM+1)                                           
C                                                                       
      REAL XLAMB,EXPON                                                  
      DIMENSION QIN(IDIM,JDIM),T(IDIM,JDIM),QOUT(KDIM)                  
      DIMENSION QSAT(KDIM),PRS(KDIM),PSTAR(IDIM)                        
      DIMENSION QEXTP(IDIM,KDIM)                                        
      DIMENSION  SIGLY(KDIM),SIGLV(KDIMP),                              
     1           CIGLY(KDIM),CIGLV(KDIMP),DEL(KDIM),                    
     2           RPI(KDIM)                                              
C                                                                       
C  QQ STORES LIMS (SATELLITE-1986-SEE J.ALPERT) OBSERVED H2O ABOVE      
C  80 MB...(K,J)-K=1,8 FOR 80,70,..,10 MB                               
C  J=1,19 FOR EVERY 10 DEG LAT (STARTING AT N.POLE)                     
C                                                                       
      DIMENSION  QQ(8,19)                                               
      SAVE QQ,ITST,CIGLV,SIGLV,DEL,SIGLY,CIGLY,RPI,PMIN,PMM,XLNPM 
      DATA QQ /32*5.  ,  4.8,4.55,4.5,4.6,4.7,4.75,4.75,4.7,            
     1 4.,3.85,3.9,4.,4.25,4.5,4.5,4.6, 3.,2.75,3.,3.3,3.7,4.2,4.3,4.5, 
     2           2.1,2.,2.,2.5,3.,3.9,4.,4. ,                           
     3 2.,2.,2.,2.3,2.8,3.5,3.7,3.75 , 2.,2.,2.,2.3,2.7,3.25,3.45,3.75, 
     4 2.,2.,2.,2.3,2.8,3.5,3.7,3.75 , 2.1,2.,2.,2.5,3.,3.9,4.,4. ,     
     5           3.,2.75,3.,3.3,3.7,4.2,4.3,4.5,                        
     6      4.,3.85,3.9,4.,4.25,4.5,4.5,4.6 ,                           
     7           4.8,4.55,4.5,4.6,4.7,4.75,4.75,4.7 , 32*5.  /          
C                                                                       
      DATA ITST / 0 /                                                   
C                                                                       
C  FIRST CONVERT MDL VIRTUAL TEMP TO THERMODYNMIC TEMP                  
C                                                                       
      IF (ITST.GT.0) GO TO 1                                            
C                                                                       
      CALL SETSIG(CIGLV,SIGLV,DEL,SIGLY,CIGLY,RPI)                      
      PMIN = 8.                                                         
      PMM  = 1.                                                         
      XLNPM =  LOG(PMIN)                                                
C                                                                       
C  GET CORRECT UNITS OF LIMS MOISTURE                                   
C                                                                       
      DO 41 J=1,19                                                      
      DO 41 K=1,8                                                       
      QQ(K,J) = QQ(K,J) * 1.E-6                                         
   41 CONTINUE                                                          
      ITST = 1                                                          
    1 CONTINUE                                                          
C                                                                       
C  LOOP FOR HEMISPHERE                                                  
C                                                                       
C                                                                       
C  GET LATITUDE IN DEGREES..                                            
C                                                                       
      DLAT = XLAT * 180.E0/3.141592653589793238                         
C                                                                       
C  LON LOOP                                                             
C                                                                       
      DO 50 IX=1,IDIM                                                   
C                                                                       
C  MODEL TEMP IS VIRTUAL (SINCE HYDROSTATIC FROM HGTS INITIALLY),       
C                                                                       
      DO 25 K=1,KDIMQ                                                   
      IF (QIN(IX,K).LE.0.0) GO TO 25                                    
      T(IX,K)=T(IX,K)*(1.0+QIN(IX,K))/(1.0+1.609*QIN(IX,K))             
   25 CONTINUE                                                          
C                                                                       
C  GET LYR PRESSURE AND THEN SATURATED MOISTURE                         
C                                                                       
      DO 5 K=1,KDIM                                                     
      PRS(K) = PSTAR(IX) * SIGLY(K)                                     
    5 CONTINUE                                                          
C                                                                       
C  COMPUTE SATURATION SPECIFIC HUMIDITY(DIMENSIONLESS) FROM             
C  TEMPERATURE T (DEG K) AND PRESSURE (CB)                              
C  CONVERSION TO SPECIFIC HUMIDITY FOLLOWS FROM DEFINITION              
C                                                                       
      DO 7 K=1,KDIM                                                     
      EXPON = 7.5*(T(IX,K)-273.)/((T(IX,K)-273.)+237.3)                 
      FAC = 6.11*10. ** EXPON                                           
      QSAT(K)=0.621 * FAC/(PRS(K)*10. - 0.379 * FAC)                    
    7 CONTINUE                                                          
C                                                                       
C  LIMIT MOISTURE IN LOWEST LEVH LAYERS--RH LE 1. BUT GE .15            
C          THE LATTER AVOIDS THE NEGATIVE Q PROBLEM...                  
C                                                                       
      DO 10 K=1,KDIMQ                                                   
      QOUT(K) = QIN(IX,K)                                               
      RH = QIN(IX,K) / QSAT(K)                                          
      IF (RH.LE..15) QOUT(K) = .15 * QSAT(K)                            
      IF (RH.GT.1.0) QOUT(K) = QSAT(K)                                  
   10 CONTINUE                                                          
C                                                                       
C  OBTAIN 8.CB (K=1) AND 1.CB (K=8) VALU BY HORIZ INTERPOLATION         
C                                                                       
      JDX = (90.-DLAT)/10.+1.                                           
      DX = (90.-DLAT)/10.+1.-JDX                                        
      Q8  = QQ(1,JDX)*(1.-DX)+QQ(1,JDX+1)*DX                            
      Q1  = QQ(8,JDX)*(1.-DX)+QQ(8,JDX+1)*DX                            
      LDRY = KDIMQ + 1                                                  
      XLNQM =  LOG(Q8)                                                  
C                                                                       
C  EXTRAPOLATE MOISTURE TO MIN VALU(Q8) AT PRESSURE PMIN(80 MB)         
C   USE EXPONENTIAL DECREASE FROM LAYER LEVH----                        
C   I.E.  Q=Q(LEVH)*(P/P(LEVH)) ** XLAMB                                
C   WHERE XLAMB IS COMPUTED TO FIT Q8 AT PMIN AND Q,P AT LEVH.          
C                                                                       
      XLNPQ =  LOG(PRS(KDIMQ))                                          
      XLNQQ =  LOG(QOUT(KDIMQ))                                         
      XLAMB = (XLNQM-XLNQQ) / (XLNPM-XLNPQ)                             
      DO 15 K=LDRY,KDIM                                                 
      IF (PRS(K).GE.PMIN) GO TO 21                                      
      IF (PRS(K).GE.PMM) GO TO 22                                       
C                                                                       
C  ABOVE PMM(10 MB) USE CONSTANT VALUE FROM TABLE                       
C                                                                       
      QOUT(K) = Q1                                                      
      GO TO 13                                                          
   21 CONTINUE                                                          
      QOUT(K) = QOUT(KDIMQ)*(PRS(K)/PRS(KDIMQ)) ** XLAMB                
      GO TO 13                                                          
   22 CONTINUE                                                          
C                                                                       
C  ABOVE 8 CB SO COMPLETE LINEAR INTERP FROM TABLE..                    
C                                                                       
      KDY = 9. - PRS(K)                                                 
      DY = 9. - PRS(K) - KDY                                            
      QOUT(K) = QQ(KDY,JDX  )*(1.0-DY)*(1.0-DX)+QQ(KDY+1,JDX+1)*DY*DX   
     1         +QQ(KDY,JDX+1)*(1.0-DY)*DX+QQ(KDY+1,JDX)*DY*(1.0-DX)     
   13 RH = QOUT(K) / QSAT(K)                                            
      IF(RH.GT.1.0) QOUT(K)=QSAT(K)                                     
   15 CONTINUE                                                          
C                                                                       
C  STORE EXTRAPOLATED MOISTURE                                          
C                                                                       
      DO 20 K=1,KDIM                                                    
      QEXTP(IX,K) = QOUT(K)                                             
   20 CONTINUE                                                          
C                                                                       
   50 CONTINUE                                                          
C                                                                       
      RETURN                                                            
      END                                                               
